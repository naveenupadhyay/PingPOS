define("common/utils/browser",["jquery","backbone","modernizr"],function(a,b,c){var d={_everPushed:!1,tryPushStateOrNavigate:function(a,b){var e=d._getWindow();return b=b||null,c.history?(e.history.pushState(b,"",a),d._everPushed=!0,!0):(e.location.href=a,!1)},tryReplaceState:function(a){var b=d._getWindow();a=a||null,c.history&&b.history.replaceState(a,"")},bindPopstateHandler:function(b){var c=d._getWindow();a(c).on("popstate",function(a){d._everPushed&&b(a)})},startBackboneHistory:function(){b.History.started||b.history.start()},stopBackboneHistory:function(){b.History.started&&b.history.stop()},_getWindow:function(){return window}};return d}),define("common/search/models/search",["backbone","jquery","underscore","common/utils/browser"],function(a,b,c,d){var e="_wml_search_actions",f={getItem:b.noop,setItem:b.noop,removeItem:b.noop},g=a.Model.extend({initialize:function(){d.bindPopstateHandler(c.bind(this.onPopstate,this))},fetchOrNavigate:function(a,c,e){var f=b("<a/>",{href:this._generateQuery(a)})[0],g=f.href;if(window.location.protocol!==f.protocol||window.location.hostname!==f.hostname||0!==f.pathname.lastIndexOf("/search",0)&&0!==f.pathname.lastIndexOf("/browse",0))window.location.href=g,this.trigger("page-reload");else if(e||d.tryPushStateOrNavigate(g)){var h;h=-1!==g.indexOf("?")?g+"&ajax=true&ts="+(new Date).getTime():g+"?ajax=true&ts="+(new Date).getTime(),this.fetch({reset:!0,url:h}),g=null}else this.trigger("page-reload");c&&(c.opts.outboundUrl=g,c.fn(c.opts))},onPopstate:function(){var a=window.location.pathname+window.location.search;this.fetchOrNavigate(a,null,!0)},fetch:function(b){this.url=b.url,a.Model.prototype.fetch.apply(this,arguments)},getLastUserAction:function(){var a=this._getSessionStorage().getItem(e);return this._getSessionStorage().removeItem(e),c.isString(a)?a:!1},setUserAction:function(a){this._getSessionStorage().setItem(e,a)},_generateQuery:function(a){if(c.isString(a))return a;var b,d=this._getWindow().location.search.substring(1),e=d.split("&"),f=!1,g=[];for(b=0;b<e.length;b++)if(e[b].length>0){var h=e[b].split("=");g.push([h[0],h[1]])}return c.each(a,function(a,c){if(null===a){for(b=0;b<g.length;b++)if(g[b][0]===c){g.splice(b,1);break}}else{var d=!1;for(b=0;b<g.length;b++)if(g[b][0]===c){g[b][1]=a,d=!0;break}d||g.push([c,a]),"sort"===c&&(f=!0)}}),d=c.reduce(g,function(a,b){return"page"===b[0]&&f&&(b[1]="1"),a.push(b[0]+"="+b[1]),a},[]).join("&"),"?"+d},_getSessionStorage:function(){return Modernizr.sessionstorage?window.sessionStorage:f},_getWindow:function(){return window}});return g}),define("common/search/models/search-singleton",["common/search/models/search"],function(a){var b=null,c={getInstance:function(){return null===b&&(b=new a),b}};return c}),define("hbs!header-tmpl/header-search-typeahead",["hbs","hbs/handlebars"],function(a,b){var c=b.template({1:function(){return"tt-suggestion-cat "},3:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return"in "+h((e=null!=(e=b.category||(null!=a?a.category:a))?e:g,typeof e===f?e.call(a,{name:"category",hash:{},data:d}):e))},5:function(a,b,c,d){var e,f="function",g=b.helperMissing,h=this.escapeExpression;return h((e=null!=(e=b.value||(null!=a?a.value:a))?e:g,typeof e===f?e.call(a,{name:"value",hash:{},data:d}):e))},compiler:[6,">= 2.0.0-beta.1"],main:function(a,b,c,d){var e,f,g="function",h=b.helperMissing,i=this.escapeExpression,j='<a href="'+i((f=null!=(f=b.href||(null!=a?a.href:a))?f:h,typeof f===g?f.call(a,{name:"href",hash:{},data:d}):f))+'" class="';return e=b["if"].call(a,null!=a?a.category:a,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d}),null!=e&&(j+=e),j+='tt-suggestion-default">',e=b["if"].call(a,null!=a?a.category:a,{name:"if",hash:{},fn:this.program(3,d),inverse:this.program(5,d),data:d}),null!=e&&(j+=e),j+='</a>\n<a href="'+i((f=null!=(f=b.href||(null!=a?a.href:a))?f:h,typeof f===g?f.call(a,{name:"href",hash:{},data:d}):f))+'" class="',e=b["if"].call(a,null!=a?a.category:a,{name:"if",hash:{},fn:this.program(1,d),inverse:this.noop,data:d}),null!=e&&(j+=e),j+='tt-suggestion-searchmobile">'+i((f=null!=(f=b.value||(null!=a?a.value:a))?f:h,typeof f===g?f.call(a,{name:"value",hash:{},data:d}):f))+" ",e=b["if"].call(a,null!=a?a.category:a,{name:"if",hash:{},fn:this.program(3,d),inverse:this.noop,data:d}),null!=e&&(j+=e),j+"</a>\n"},useData:!0});return b.registerPartial("header-tmpl/header-search-typeahead",c),c}),function(a){define("bloodhound",["jquery"],function(){return function(){return function(a){var b=function(){return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(a){return!a||/^\s*$/.test(a)},escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isArray:a.isArray,isFunction:a.isFunction,isObject:a.isPlainObject,isUndefined:function(a){return"undefined"==typeof a},toStr:function(a){return b.isUndefined(a)||null===a?"":a+""},bind:a.proxy,each:function(b,c){function d(a,b){return c(b,a)}a.each(b,d)},map:a.map,filter:a.grep,every:function(b,c){var d=!0;return b?(a.each(b,function(a,e){return(d=c.call(null,e,a,b))?void 0:!1}),!!d):d},some:function(b,c){var d=!1;return b?(a.each(b,function(a,e){return(d=c.call(null,e,a,b))?!1:void 0}),!!d):d},mixin:a.extend,getUniqueId:function(){var a=0;return function(){return a++}}(),templatify:function(b){function c(){return String(b)}return a.isFunction(b)?b:c},defer:function(a){setTimeout(a,0)},debounce:function(a,b,c){var d,e;return function(){var f,g,h=this,i=arguments;return f=function(){d=null,c||(e=a.apply(h,i))},g=c&&!d,clearTimeout(d),d=setTimeout(f,b),g&&(e=a.apply(h,i)),e}},throttle:function(a,b){var c,d,e,f,g,h;return g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)},function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},noop:function(){}}}(),c="0.10.5",d=function(){function a(a){return a=b.toStr(a),a?a.split(/\s+/):[]}function c(a){return a=b.toStr(a),a?a.split(/\W+/):[]}function d(a){return function(){var c=[].slice.call(arguments,0);return function(d){var e=[];return b.each(c,function(c){e=e.concat(a(b.toStr(d[c])))}),e}}}return{nonword:c,whitespace:a,obj:{nonword:d(c),whitespace:d(a)}}}(),e=function(){function c(c){this.maxSize=b.isNumber(c)?c:100,this.reset(),this.maxSize<=0&&(this.set=this.get=a.noop)}function d(){this.head=this.tail=null}function e(a,b){this.key=a,this.val=b,this.prev=this.next=null}return b.mixin(c.prototype,{set:function(a,b){var c,d=this.list.tail;this.size>=this.maxSize&&(this.list.remove(d),delete this.hash[d.key]),(c=this.hash[a])?(c.val=b,this.list.moveToFront(c)):(c=new e(a,b),this.list.add(c),this.hash[a]=c,this.size++)},get:function(a){var b=this.hash[a];return b?(this.list.moveToFront(b),b.val):void 0},reset:function(){this.size=0,this.hash={},this.list=new d}}),b.mixin(d.prototype,{add:function(a){this.head&&(a.next=this.head,this.head.prev=a),this.head=a,this.tail=this.tail||a},remove:function(a){a.prev?a.prev.next=a.next:this.head=a.next,a.next?a.next.prev=a.prev:this.tail=a.prev},moveToFront:function(a){this.remove(a),this.add(a)}}),c}(),f=function(){function a(a){this.prefix=["__",a,"__"].join(""),this.ttlKey="__ttl__",this.keyMatcher=new RegExp("^"+b.escapeRegExChars(this.prefix))}function c(){return(new Date).getTime()}function d(a){return JSON.stringify(b.isUndefined(a)?null:a)}function e(a){return JSON.parse(a)}var f,g;try{f=window.localStorage,f.setItem("~~~","!"),f.removeItem("~~~")}catch(h){f=null}return g=f&&window.JSON?{_prefix:function(a){return this.prefix+a},_ttlKey:function(a){return this._prefix(a)+this.ttlKey},get:function(a){return this.isExpired(a)&&this.remove(a),e(f.getItem(this._prefix(a)))},set:function(a,e,g){return b.isNumber(g)?f.setItem(this._ttlKey(a),d(c()+g)):f.removeItem(this._ttlKey(a)),f.setItem(this._prefix(a),d(e))},remove:function(a){return f.removeItem(this._ttlKey(a)),f.removeItem(this._prefix(a)),this},clear:function(){var a,b,c=[],d=f.length;for(a=0;d>a;a++)(b=f.key(a)).match(this.keyMatcher)&&c.push(b.replace(this.keyMatcher,""));for(a=c.length;a--;)this.remove(c[a]);return this},isExpired:function(a){var d=e(f.getItem(this._ttlKey(a)));return b.isNumber(d)&&c()>d?!0:!1}}:{get:b.noop,set:b.noop,remove:b.noop,clear:b.noop,isExpired:b.noop},b.mixin(a.prototype,g),a}(),g=function(){function c(b){b=b||{},this.cancelled=!1,this.lastUrl=null,this._send=b.transport?d(b.transport):a.ajax,this._get=b.rateLimiter?b.rateLimiter(this._get):this._get,this._cache=b.cache===!1?new e(0):i}function d(c){return function(d,e){function f(a){b.defer(function(){h.resolve(a)})}function g(a){b.defer(function(){h.reject(a)})}var h=a.Deferred();return c(d,e,f,g),h}}var f=0,g={},h=6,i=new e(10);return c.setMaxPendingRequests=function(a){h=a},c.resetCache=function(){i.reset()},b.mixin(c.prototype,{_get:function(a,b,c){function d(b){c&&c(null,b),k._cache.set(a,b)}function e(){c&&c(!0)}function i(){f--,delete g[a],k.onDeckRequestArgs&&(k._get.apply(k,k.onDeckRequestArgs),k.onDeckRequestArgs=null)}var j,k=this;this.cancelled||a!==this.lastUrl||((j=g[a])?j.done(d).fail(e):h>f?(f++,g[a]=this._send(a,b).done(d).fail(e).always(i)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(a,c,d){var e;return b.isFunction(c)&&(d=c,c={}),this.cancelled=!1,this.lastUrl=a,(e=this._cache.get(a))?b.defer(function(){d&&d(null,e)}):this._get(a,c,d),!!e},cancel:function(){this.cancelled=!0}}),c}(),h=function(){function c(b){b=b||{},b.datumTokenizer&&b.queryTokenizer||a.error("datumTokenizer and queryTokenizer are both required"),this.datumTokenizer=b.datumTokenizer,this.queryTokenizer=b.queryTokenizer,this.reset()}function d(a){return a=b.filter(a,function(a){return!!a}),a=b.map(a,function(a){return a.toLowerCase()})}function e(){return{ids:[],children:{}}}function f(a){for(var b={},c=[],d=0,e=a.length;e>d;d++)b[a[d]]||(b[a[d]]=!0,c.push(a[d]));return c}function g(a,b){function c(a,b){return a-b}var d=0,e=0,f=[];a=a.sort(c),b=b.sort(c);for(var g=a.length,h=b.length;g>d&&h>e;)a[d]<b[e]?d++:a[d]>b[e]?e++:(f.push(a[d]),d++,e++);return f}return b.mixin(c.prototype,{bootstrap:function(a){this.datums=a.datums,this.trie=a.trie},add:function(a){var c=this;a=b.isArray(a)?a:[a],b.each(a,function(a){var f,g;f=c.datums.push(a)-1,g=d(c.datumTokenizer(a)),b.each(g,function(a){var b,d,g;for(b=c.trie,d=a.split("");g=d.shift();)b=b.children[g]||(b.children[g]=e()),b.ids.push(f)})})},get:function(a){var c,e,h=this;return c=d(this.queryTokenizer(a)),b.each(c,function(a){var b,c,d,f;if(e&&0===e.length)return!1;for(b=h.trie,c=a.split("");b&&(d=c.shift());)b=b.children[d];return b&&0===c.length?(f=b.ids.slice(0),void(e=e?g(e,f):f)):(e=[],!1)}),e?b.map(f(e),function(a){return h.datums[a]}):[]},reset:function(){this.datums=[],this.trie=e()},serialize:function(){return{datums:this.datums,trie:this.trie}}}),c}(),i=function(){function d(a){return a.local||null}function e(d){var e,f;return f={url:null,thumbprint:"",ttl:864e5,filter:null,ajax:{}},(e=d.prefetch||null)&&(e=b.isString(e)?{url:e}:e,e=b.mixin(f,e),e.thumbprint=c+e.thumbprint,e.ajax.type=e.ajax.type||"GET",e.ajax.dataType=e.ajax.dataType||"json",!e.url&&a.error("prefetch requires url to be set")),e}function f(c){function d(a){return function(c){return b.debounce(c,a)}}function e(a){return function(c){return b.throttle(c,a)}}var f,g;return g={url:null,cache:!0,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}},(f=c.remote||null)&&(f=b.isString(f)?{url:f}:f,f=b.mixin(g,f),f.rateLimiter=/^throttle$/i.test(f.rateLimitBy)?e(f.rateLimitWait):d(f.rateLimitWait),f.ajax.type=f.ajax.type||"GET",f.ajax.dataType=f.ajax.dataType||"json",delete f.rateLimitBy,delete f.rateLimitWait,!f.url&&a.error("remote requires url to be set")),f}return{local:d,prefetch:e,remote:f}}();!function(c){function e(b){b&&(b.local||b.prefetch||b.remote)||a.error("one of local, prefetch, or remote is required"),this.limit=b.limit||5,this.sorter=j(b.sorter),this.dupDetector=b.dupDetector||k,this.local=i.local(b),this.prefetch=i.prefetch(b),this.remote=i.remote(b),this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null,this.index=new h({datumTokenizer:b.datumTokenizer,queryTokenizer:b.queryTokenizer}),this.storage=this.cacheKey?new f(this.cacheKey):null}function j(a){function c(b){return b.sort(a)}function d(a){return a}return b.isFunction(a)?c:d}function k(){return!1}var l,m;return l=c.Bloodhound,m={data:"data",protocol:"protocol",thumbprint:"thumbprint"},c.Bloodhound=e,e.noConflict=function(){return c.Bloodhound=l,e},e.tokenizers=d,b.mixin(e.prototype,{_loadPrefetch:function(b){function c(a){f.clear(),f.add(b.filter?b.filter(a):a),f._saveToStorage(f.index.serialize(),b.thumbprint,b.ttl)}var d,e,f=this;return(d=this._readFromStorage(b.thumbprint))?(this.index.bootstrap(d),e=a.Deferred().resolve()):e=a.ajax(b.url,b.ajax).done(c),e},_getFromRemote:function(a,b){function c(a,c){b(a?[]:f.remote.filter?f.remote.filter(c):c)}var d,e,f=this;if(this.transport)return a=a||"",e=encodeURIComponent(a),d=this.remote.replace?this.remote.replace(this.remote.url,a):this.remote.url.replace(this.remote.wildcard,e),this.transport.get(d,this.remote.ajax,c)},_cancelLastRemoteRequest:function(){this.transport&&this.transport.cancel()},_saveToStorage:function(a,b,c){this.storage&&(this.storage.set(m.data,a,c),this.storage.set(m.protocol,location.protocol,c),this.storage.set(m.thumbprint,b,c))},_readFromStorage:function(a){var b,c={};return this.storage&&(c.data=this.storage.get(m.data),c.protocol=this.storage.get(m.protocol),c.thumbprint=this.storage.get(m.thumbprint)),b=c.thumbprint!==a||c.protocol!==location.protocol,c.data&&!b?c.data:null},_initialize:function(){function c(){e.add(b.isFunction(f)?f():f)}var d,e=this,f=this.local;return d=this.prefetch?this._loadPrefetch(this.prefetch):a.Deferred().resolve(),f&&d.done(c),this.transport=this.remote?new g(this.remote):null,this.initPromise=d.promise()},initialize:function(a){return!this.initPromise||a?this._initialize():this.initPromise},add:function(a){this.index.add(a)},get:function(a,c){function d(a){var d=f.slice(0);b.each(a,function(a){var c;return c=b.some(d,function(b){return e.dupDetector(a,b)}),!c&&d.push(a),d.length<e.limit}),c&&c(e.sorter(d))}var e=this,f=[],g=!1;f=this.index.get(a),f=this.sorter(f).slice(0,this.limit),f.length<this.limit?g=this._getFromRemote(a,d):this._cancelLastRemoteRequest(),g||(f.length>0||!this.transport)&&c&&c(f)},clear:function(){this.index.reset()},clearPrefetchCache:function(){this.storage&&this.storage.clear()},clearRemoteCache:function(){this.transport&&g.resetCache()},ttAdapter:function(){return b.bind(this.get,this)}}),e}(this)}(window.jQuery),a.Bloodhound=Bloodhound}.apply(a,arguments)})}(this),define("common/utils/vent",["backbone","underscore"],function(a,b){return b.extend({},a.Events)}),function(a){define("hammerjs",["jquery"],function(){return function(){return function(a,b){function c(){if(!d.READY){d.event.determineEventTypes();for(var a in d.gestures)d.gestures.hasOwnProperty(a)&&d.detection.register(d.gestures[a]);d.event.onTouch(d.DOCUMENT,d.EVENT_MOVE,d.detection.detect),d.event.onTouch(d.DOCUMENT,d.EVENT_END,d.detection.detect),d.READY=!0}}var d=function(a,b){return new d.Instance(a,b||{})};d.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},d.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,d.HAS_TOUCHEVENTS="ontouchstart"in a,d.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,d.NO_MOUSEEVENTS=d.HAS_TOUCHEVENTS&&navigator.userAgent.match(d.MOBILE_REGEX),d.EVENT_TYPES={},d.DIRECTION_DOWN="down",d.DIRECTION_LEFT="left",d.DIRECTION_UP="up",d.DIRECTION_RIGHT="right",d.POINTER_MOUSE="mouse",d.POINTER_TOUCH="touch",d.POINTER_PEN="pen",d.EVENT_START="start",d.EVENT_MOVE="move",d.EVENT_END="end",d.DOCUMENT=document,d.plugins={},d.READY=!1,d.Instance=function(a,b){var e=this;return c(),this.element=a,this.enabled=!0,this.options=d.utils.extend(d.utils.extend({},d.defaults),b||{}),this.options.stop_browser_behavior&&d.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),d.event.onTouch(a,d.EVENT_START,function(a){e.enabled&&d.detection.startDetect(e,a)}),this},d.Instance.prototype={on:function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)this.element.addEventListener(c[d],b,!1);return this},off:function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)this.element.removeEventListener(c[d],b,!1);return this},trigger:function(a,b){var c=d.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b;var e=this.element;return d.utils.hasParent(b.target,e)&&(e=b.target),e.dispatchEvent(c),this},enable:function(a){return this.enabled=a,this}};var e=null,f=!1,g=!1;d.event={bindDom:function(a,b,c){for(var d=b.split(" "),e=0;e<d.length;e++)a.addEventListener(d[e],c,!1)},onTouch:function(a,b,c){var h=this;this.bindDom(a,d.EVENT_TYPES[b],function(i){var j=i.type.toLowerCase();if(!j.match(/mouse/)||!g){(j.match(/touch/)||j.match(/pointerdown/)||j.match(/mouse/)&&1===i.which)&&(f=!0),j.match(/touch|pointer/)&&(g=!0);var k=0;f&&(d.HAS_POINTEREVENTS&&b!=d.EVENT_END?k=d.PointerEvent.updatePointer(b,i):j.match(/touch/)?k=i.touches.length:g||(k=j.match(/up/)?0:1),k>0&&b==d.EVENT_END?b=d.EVENT_MOVE:k||(b=d.EVENT_END),k||null===e?e=i:i=e,c.call(d.detection,h.collectEventData(a,b,i)),d.HAS_POINTEREVENTS&&b==d.EVENT_END&&(k=d.PointerEvent.updatePointer(b,i))),k||(e=null,f=!1,g=!1,d.PointerEvent.reset())}})},determineEventTypes:function(){var a;a=d.HAS_POINTEREVENTS?d.PointerEvent.getEvents():d.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],d.EVENT_TYPES[d.EVENT_START]=a[0],d.EVENT_TYPES[d.EVENT_MOVE]=a[1],d.EVENT_TYPES[d.EVENT_END]=a[2]},getTouchList:function(a){return d.HAS_POINTEREVENTS?d.PointerEvent.getTouchList():a.touches?a.touches:[{identifier:1,pageX:a.pageX,pageY:a.pageY,target:a.target}]},collectEventData:function(a,b,c){var e=this.getTouchList(c,b),f=d.POINTER_TOUCH;return(c.type.match(/mouse/)||d.PointerEvent.matchType(d.POINTER_MOUSE,c))&&(f=d.POINTER_MOUSE),{center:d.utils.getCenter(e),timeStamp:(new Date).getTime(),target:c.target,touches:e,eventType:b,pointerType:f,srcEvent:c,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return d.detection.stopDetect()}}}},d.PointerEvent={pointers:{},getTouchList:function(){var a=this,b=[];return Object.keys(a.pointers).sort().forEach(function(c){b.push(a.pointers[c])}),b},updatePointer:function(a,b){return a==d.EVENT_END?this.pointers={}:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b),Object.keys(this.pointers).length},matchType:function(a,b){if(!b.pointerType)return!1;var c={};return c[d.POINTER_MOUSE]=b.pointerType==b.MSPOINTER_TYPE_MOUSE||b.pointerType==d.POINTER_MOUSE,c[d.POINTER_TOUCH]=b.pointerType==b.MSPOINTER_TYPE_TOUCH||b.pointerType==d.POINTER_TOUCH,c[d.POINTER_PEN]=b.pointerType==b.MSPOINTER_TYPE_PEN||b.pointerType==d.POINTER_PEN,c[a]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},d.utils={extend:function(a,c,d){for(var e in c)a[e]!==b&&d||(a[e]=c[e]);return a},hasParent:function(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1},getCenter:function(a){for(var b=[],c=[],d=0,e=a.length;e>d;d++)b.push(a[d].pageX),c.push(a[d].pageY);return{pageX:(Math.min.apply(Math,b)+Math.max.apply(Math,b))/2,pageY:(Math.min.apply(Math,c)+Math.max.apply(Math,c))/2}},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){var c=b.pageY-a.pageY,d=b.pageX-a.pageX;return 180*Math.atan2(c,d)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.pageX-b.pageX),e=Math.abs(a.pageY-b.pageY);return c>=e?a.pageX-b.pageX>0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT:a.pageY-b.pageY>0?d.DIRECTION_UP:d.DIRECTION_DOWN},getDistance:function(a,b){var c=b.pageX-a.pageX,d=b.pageY-a.pageY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return a.length>=2&&b.length>=2?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return a.length>=2&&b.length>=2?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==d.DIRECTION_UP||a==d.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(a,b){var c,d=["webkit","khtml","moz","ms","o",""];if(b&&a.style){for(var e=0;e<d.length;e++)for(var f in b)b.hasOwnProperty(f)&&(c=f,d[e]&&(c=d[e]+c.substring(0,1).toUpperCase()+c.substring(1)),a.style[c]=b[f]);"none"==b.userSelect&&(a.onselectstart=function(){return!1})}}},d.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:d.utils.extend({},b),lastEvent:!1,name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){a=this.extendEventData(a);for(var b=this.current.inst.options,c=0,e=this.gestures.length;e>c;c++){var f=this.gestures[c];if(!this.stopped&&b[f.name]!==!1&&f.handler.call(f,a,this.current.inst)===!1){this.stopDetect();break}}return this.current&&(this.current.lastEvent=a),a.eventType==d.EVENT_END&&!a.touches.length-1&&this.stopDetect(),a}},stopDetect:function(){this.previous=d.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(a){var b=this.current.startEvent;if(b&&(a.touches.length!=b.touches.length||a.touches===b.touches)){b.touches=[];for(var c=0,e=a.touches.length;e>c;c++)b.touches.push(d.utils.extend({},a.touches[c]))}var f=a.timeStamp-b.timeStamp,g=a.center.pageX-b.center.pageX,h=a.center.pageY-b.center.pageY,i=d.utils.getVelocity(f,g,h);return d.utils.extend(a,{deltaTime:f,deltaX:g,deltaY:h,velocityX:i.x,velocityY:i.y,distance:d.utils.getDistance(b.center,a.center),angle:d.utils.getAngle(b.center,a.center),direction:d.utils.getDirection(b.center,a.center),scale:d.utils.getScale(b.touches,a.touches),rotation:d.utils.getRotation(b.touches,a.touches),startEvent:b}),a},register:function(a){var c=a.defaults||{};return c[a.name]===b&&(c[a.name]=!0),d.utils.extend(d.defaults,c,!0),a.index=a.index||1e3,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}},d.gestures=d.gestures||{},d.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(a,b){switch(a.eventType){case d.EVENT_START:clearTimeout(this.timer),d.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==d.detection.current.name&&b.trigger("hold",a)},b.options.hold_timeout);break;case d.EVENT_MOVE:a.distance>b.options.hold_threshold&&clearTimeout(this.timer);break;case d.EVENT_END:clearTimeout(this.timer)}}},d.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(a,b){if(a.eventType==d.EVENT_END){var c=d.detection.previous,e=!1;if(a.deltaTime>b.options.tap_max_touchtime||a.distance>b.options.tap_max_distance)return;c&&"tap"==c.name&&a.timeStamp-c.lastEvent.timeStamp<b.options.doubletap_interval&&a.distance<b.options.doubletap_distance&&(b.trigger("doubletap",a),e=!0),(!e||b.options.tap_always)&&(d.detection.current.name="tap",b.trigger(d.detection.current.name,a))}}},d.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(a,b){if(a.eventType==d.EVENT_END){if(b.options.swipe_max_touches>0&&a.touches.length>b.options.swipe_max_touches)return;(a.velocityX>b.options.swipe_velocity||a.velocityY>b.options.swipe_velocity)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}}},d.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),void(this.triggered=!1);if(!(b.options.drag_max_touches>0&&a.touches.length>b.options.drag_max_touches))switch(a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:if(a.distance<b.options.drag_min_distance&&d.detection.current.name!=this.name)return;d.detection.current.name=this.name,(d.detection.current.lastEvent.drag_locked_to_axis||b.options.drag_lock_to_axis&&b.options.drag_lock_min_distance<=a.distance)&&(a.drag_locked_to_axis=!0);var c=d.detection.current.lastEvent.direction;a.drag_locked_to_axis&&c!==a.direction&&(a.direction=d.utils.isVertical(c)?a.deltaY<0?d.DIRECTION_UP:d.DIRECTION_DOWN:a.deltaX<0?d.DIRECTION_LEFT:d.DIRECTION_RIGHT),this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),b.trigger(this.name+a.direction,a),(b.options.drag_block_vertical&&d.utils.isVertical(a.direction)||b.options.drag_block_horizontal&&!d.utils.isVertical(a.direction))&&a.preventDefault();break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},d.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(a,b){if(d.detection.current.name!=this.name&&this.triggered)return b.trigger(this.name+"end",a),void(this.triggered=!1);if(!(a.touches.length<2))switch(b.options.transform_always_block&&a.preventDefault(),a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:var c=Math.abs(1-a.scale),e=Math.abs(a.rotation);if(c<b.options.transform_min_scale&&e<b.options.transform_min_rotation)return;d.detection.current.name=this.name,this.triggered||(b.trigger(this.name+"start",a),this.triggered=!0),b.trigger(this.name,a),e>b.options.transform_min_rotation&&b.trigger("rotate",a),c>b.options.transform_min_scale&&(b.trigger("pinch",a),b.trigger("pinch"+(a.scale<1?"in":"out"),a));break;case d.EVENT_END:this.triggered&&b.trigger(this.name+"end",a),this.triggered=!1}}},d.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(a,b){return b.options.prevent_mouseevents&&a.pointerType==d.POINTER_MOUSE?void a.stopDetect():(b.options.prevent_default&&a.preventDefault(),void(a.eventType==d.EVENT_START&&b.trigger(this.name,a)))}},d.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==d.EVENT_END&&b.trigger(this.name,a)}},"object"==typeof module&&"object"==typeof module.exports?module.exports=d:(a.Hammer=d,"function"==typeof a.define&&a.define.amd&&a.define("hammer",[],function(){return d}))}(this),function(a,b){a!==b&&(Hammer.event.bindDom=function(c,d,e){a(c).on(d,function(a){var c=a.originalEvent||a;c.pageX===b&&(c.pageX=a.pageX,c.pageY=a.pageY),c.target||(c.target=a.target),c.which===b&&(c.which=c.button),c.preventDefault||(c.preventDefault=a.preventDefault),c.stopPropagation||(c.stopPropagation=a.stopPropagation),e.call(this,c)})},Hammer.Instance.prototype.on=function(b,c){return a(this.element).on(b,c)},Hammer.Instance.prototype.off=function(b,c){return a(this.element).off(b,c)},Hammer.Instance.prototype.trigger=function(b,c){var d=a(this.element);return d.has(c.target).length&&(d=a(c.target)),d.trigger({type:b,gesture:c})},a.fn.hammer=function(b){return this.each(function(){var c=a(this),d=c.data("hammer");d?d&&b&&Hammer.utils.extend(d.options,b):c.data("hammer",new Hammer(this,b||{}))})})}(window.jQuery||window.Zepto),a.Hammer=Hammer}.apply(a,arguments)})}(this),function(a){define("jquery.typeahead",["jquery"],function(){return function(){return function(a){var b=function(){return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(a){return!a||/^\s*$/.test(a)},escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isArray:a.isArray,isFunction:a.isFunction,isObject:a.isPlainObject,isUndefined:function(a){return"undefined"==typeof a},toStr:function(a){return b.isUndefined(a)||null===a?"":a+""},bind:a.proxy,each:function(b,c){function d(a,b){return c(b,a)}a.each(b,d)},map:a.map,filter:a.grep,every:function(b,c){var d=!0;return b?(a.each(b,function(a,e){return(d=c.call(null,e,a,b))?void 0:!1}),!!d):d},some:function(b,c){var d=!1;return b?(a.each(b,function(a,e){return(d=c.call(null,e,a,b))?!1:void 0}),!!d):d},mixin:a.extend,getUniqueId:function(){var a=0;return function(){return a++}}(),templatify:function(b){function c(){return String(b)}return a.isFunction(b)?b:c},defer:function(a){setTimeout(a,0)},debounce:function(a,b,c){var d,e;return function(){var f,g,h=this,i=arguments;return f=function(){d=null,c||(e=a.apply(h,i))},g=c&&!d,clearTimeout(d),d=setTimeout(f,b),g&&(e=a.apply(h,i)),e}},throttle:function(a,b){var c,d,e,f,g,h;return g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)},function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},noop:function(){}}}(),c=function(){return{wrapper:'<span class="twitter-typeahead"></span>',dropdown:'<span class="tt-dropdown-menu"></span>',dataset:'<div class="tt-dataset-%CLASS%"></div>',suggestions:'<span class="tt-suggestions"></span>',suggestion:'<div class="tt-suggestion"></div>'}}(),d=function(){var a={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};return b.isMsie()&&b.mixin(a.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),b.isMsie()&&b.isMsie()<=7&&b.mixin(a.input,{marginTop:"-1px"}),a}(),e=function(){function c(b){b&&b.el||a.error("EventBus initialized without el"),this.$el=a(b.el)}var d="typeahead:";return b.mixin(c.prototype,{trigger:function(a){var b=[].slice.call(arguments,1);this.$el.trigger(d+a,b)}}),c}(),f=function(){function a(a,b,c,d){var e;if(!c)return this;for(b=b.split(i),c=d?h(c,d):c,this._callbacks=this._callbacks||{};e=b.shift();)this._callbacks[e]=this._callbacks[e]||{sync:[],async:[]},this._callbacks[e][a].push(c);return this}function b(b,c,d){return a.call(this,"async",b,c,d)}function c(b,c,d){return a.call(this,"sync",b,c,d)}function d(a){var b;if(!this._callbacks)return this;for(a=a.split(i);b=a.shift();)delete this._callbacks[b];return this}function e(a){var b,c,d,e,g;if(!this._callbacks)return this;for(a=a.split(i),d=[].slice.call(arguments,1);(b=a.shift())&&(c=this._callbacks[b]);)e=f(c.sync,this,[b].concat(d)),g=f(c.async,this,[b].concat(d)),e()&&j(g);return this}function f(a,b,c){function d(){for(var d,e=0,f=a.length;!d&&f>e;e+=1)d=a[e].apply(b,c)===!1;return!d}return d}function g(){var a;return a=window.setImmediate?function(a){setImmediate(function(){a()})}:function(a){setTimeout(function(){a()},0)}}function h(a,b){return a.bind?a.bind(b):function(){a.apply(b,[].slice.call(arguments,0))}}var i=/\s+/,j=g();return{onSync:c,onAsync:b,off:d,trigger:e}}(),g=function(a){function c(a,c,d){for(var e,f=[],g=0,h=a.length;h>g;g++)f.push(b.escapeRegExChars(a[g]));
return e=d?"\\b("+f.join("|")+")\\b":"("+f.join("|")+")",c?new RegExp(e):new RegExp(e,"i")}var d={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(e){function f(b){var c,d,f;return(c=h.exec(b.data))&&(f=a.createElement(e.tagName),e.className&&(f.className=e.className),d=b.splitText(c.index),d.splitText(c[0].length),f.appendChild(d.cloneNode(!0)),b.parentNode.replaceChild(f,d)),!!c}function g(a,b){for(var c,d=3,e=0;e<a.childNodes.length;e++)c=a.childNodes[e],c.nodeType===d?e+=b(c)?1:0:g(c,b)}var h;e=b.mixin({},d,e),e.node&&e.pattern&&(e.pattern=b.isArray(e.pattern)?e.pattern:[e.pattern],h=c(e.pattern,e.caseSensitive,e.wordsOnly),g(e.node,f))}}(window.document),h=function(){function c(c){var e,f,g,i,j=this;c=c||{},c.input||a.error("input is missing"),e=b.bind(this._onBlur,this),f=b.bind(this._onFocus,this),g=b.bind(this._onKeydown,this),i=b.bind(this._onInput,this),this.$hint=a(c.hint),this.$input=a(c.input).on("blur.tt",e).on("focus.tt",f).on("keydown.tt",g),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=b.noop),b.isMsie()?this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(a){h[a.which||a.keyCode]||b.defer(b.bind(j._onInput,j,a))}):this.$input.on("input.tt",i),this.query=this.$input.val(),this.$overflowHelper=d(this.$input)}function d(b){return a('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:b.css("font-family"),fontSize:b.css("font-size"),fontStyle:b.css("font-style"),fontVariant:b.css("font-variant"),fontWeight:b.css("font-weight"),wordSpacing:b.css("word-spacing"),letterSpacing:b.css("letter-spacing"),textIndent:b.css("text-indent"),textRendering:b.css("text-rendering"),textTransform:b.css("text-transform")}).insertAfter(b)}function e(a,b){return c.normalizeQuery(a)===c.normalizeQuery(b)}function g(a){return a.altKey||a.ctrlKey||a.metaKey||a.shiftKey}var h;return h={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},c.normalizeQuery=function(a){return(a||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")},b.mixin(c.prototype,f,{_onBlur:function(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function(a){var b=h[a.which||a.keyCode];this._managePreventDefault(b,a),b&&this._shouldTrigger(b,a)&&this.trigger(b+"Keyed",a)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(a,b){var c,d,e;switch(a){case"tab":d=this.getHint(),e=this.getInputValue(),c=d&&d!==e&&!g(b);break;case"up":case"down":c=!g(b);break;default:c=!1}c&&b.preventDefault()},_shouldTrigger:function(a,b){var c;switch(a){case"tab":c=!g(b);break;default:c=!0}return c},_checkInputValue:function(){var a,b,c;a=this.getInputValue(),b=e(a,this.query),c=b?this.query.length!==a.length:!1,this.query=a,b?c&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(a){this.query=a},getInputValue:function(){return this.$input.val()},setInputValue:function(a,b){this.$input.val(a),b?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(a){this.$hint.val(a)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var a,b,c,d;a=this.getInputValue(),b=this.getHint(),c=a!==b&&0===b.indexOf(a),d=""!==a&&c&&!this.hasOverflow(),!d&&this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var a=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=a},isCursorAtEnd:function(){var a,c,d;return a=this.$input.val().length,c=this.$input[0].selectionStart,b.isNumber(c)?c===a:document.selection?(d=document.selection.createRange(),d.moveStart("character",-a),a===d.text.length):!0},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$hint=this.$input=this.$overflowHelper=null}}),c}(),i=function(){function e(d){d=d||{},d.templates=d.templates||{},d.source||a.error("missing source"),d.name&&!j(d.name)&&a.error("invalid dataset name: "+d.name),this.query=null,this.highlight=!!d.highlight,this.name=d.name||b.getUniqueId(),this.source=d.source,this.displayFn=h(d.display||d.displayKey),this.templates=i(d.templates,this.displayFn),this.$el=a(c.dataset.replace("%CLASS%",this.name))}function h(a){function c(b){return b[a]}return a=a||"value",b.isFunction(a)?a:c}function i(a,c){function d(a){return"<p>"+c(a)+"</p>"}return{empty:a.empty&&b.templatify(a.empty),header:a.header&&b.templatify(a.header),footer:a.footer&&b.templatify(a.footer),suggestion:a.suggestion||d}}function j(a){return/^[_a-zA-Z0-9-]+$/.test(a)}var k="ttDataset",l="ttValue",m="ttDatum";return e.extractDatasetName=function(b){return a(b).data(k)},e.extractValue=function(b){return a(b).data(l)},e.extractDatum=function(b){return a(b).data(m)},b.mixin(e.prototype,f,{_render:function(e,f){function h(){return p.templates.empty({query:e,isEmpty:!0})}function i(){function h(b){var e;return e=a(c.suggestion).append(p.templates.suggestion(b)).data(k,p.name).data(l,p.displayFn(b)).data(m,b),e.children().each(function(){a(this).css(d.suggestionChild)}),e}var i,j;return i=a(c.suggestions).css(d.suggestions),j=b.map(f,h),i.append.apply(i,j),p.highlight&&g({className:"tt-highlight",node:i[0],pattern:e}),i}function j(){return p.templates.header({query:e,isEmpty:!o})}function n(){return p.templates.footer({query:e,isEmpty:!o})}if(this.$el){var o,p=this;this.$el.empty(),o=f&&f.length,!o&&this.templates.empty?this.$el.html(h()).prepend(p.templates.header?j():null).append(p.templates.footer?n():null):o&&this.$el.html(i()).prepend(p.templates.header?j():null).append(p.templates.footer?n():null),this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(a){function b(b){c.canceled||a!==c.query||c._render(a,b)}var c=this;this.query=a,this.canceled=!1,this.source(a,b)},cancel:function(){this.canceled=!0},clear:function(){this.cancel(),this.$el.empty(),this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}}),e}(),j=function(){function c(c){var d,f,g,h=this;c=c||{},c.menu||a.error("menu is required"),this.isOpen=!1,this.isEmpty=!0,this.datasets=b.map(c.datasets,e),d=b.bind(this._onSuggestionClick,this),f=b.bind(this._onSuggestionMouseEnter,this),g=b.bind(this._onSuggestionMouseLeave,this),this.$menu=a(c.menu).on("click.tt",".tt-suggestion",d).on("mouseenter.tt",".tt-suggestion",f).on("mouseleave.tt",".tt-suggestion",g),b.each(this.datasets,function(a){h.$menu.append(a.getRoot()),a.onSync("rendered",h._onRendered,h)})}function e(a){return new i(a)}return b.mixin(c.prototype,f,{_onSuggestionClick:function(b){this.trigger("suggestionClicked",a(b.currentTarget))},_onSuggestionMouseEnter:function(b){this._removeCursor(),this._setCursor(a(b.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){function a(a){return a.isEmpty()}this.isEmpty=b.every(this.datasets,a),this.isEmpty?this._hide():this.isOpen&&this._show(),this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(a,b){a.first().addClass("tt-cursor"),!b&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function(a){var b,c,d,e;if(this.isOpen){if(c=this._getCursor(),b=this._getSuggestions(),this._removeCursor(),d=b.index(c)+a,d=(d+1)%(b.length+1)-1,-1===d)return void this.trigger("cursorRemoved");-1>d&&(d=b.length-1),this._setCursor(e=b.eq(d)),this._ensureVisible(e)}},_ensureVisible:function(a){var b,c,d,e;b=a.position().top,c=b+a.outerHeight(!0),d=this.$menu.scrollTop(),e=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),0>b?this.$menu.scrollTop(d+b):c>e&&this.$menu.scrollTop(d+(c-e))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(a){this.$menu.css("ltr"===a?d.ltr:d.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function(a){var b=null;return a.length&&(b={raw:i.extractDatum(a),value:i.extractValue(a),datasetName:i.extractDatasetName(a)}),b},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(a){function c(b){b.update(a)}b.each(this.datasets,c)},empty:function(){function a(a){a.clear()}b.each(this.datasets,a),this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){function a(a){a.destroy()}this.$menu.off(".tt"),this.$menu=null,b.each(this.datasets,a)}}),c}(),k=function(){function f(c){var d,f,i;c=c||{},c.input||a.error("missing input"),this.isActivated=!1,this.autoselect=!!c.autoselect,this.minLength=b.isNumber(c.minLength)?c.minLength:1,this.$node=g(c.input,c.withHint),d=this.$node.find(".tt-dropdown-menu"),f=this.$node.find(".tt-input"),i=this.$node.find(".tt-hint"),f.on("blur.tt",function(a){var c,e,g;c=document.activeElement,e=d.is(c),g=d.has(c).length>0,b.isMsie()&&(e||g)&&(a.preventDefault(),a.stopImmediatePropagation(),b.defer(function(){f.focus()}))}),d.on("mousedown.tt",function(a){a.preventDefault()}),this.eventBus=c.eventBus||new e({el:f}),this.dropdown=new j({menu:d,datasets:c.datasets}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this),this.input=new h({input:f,hint:i}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this),this._setLanguageDirection()}function g(b,e){var f,g,h,j;f=a(b),g=a(c.wrapper),h=a(c.dropdown).css(d.dropdown),j=f.clone().css(d.hint).css(i(f)),j.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder required").prop("readonly",!0).attr({autocomplete:"off",spellcheck:"false",tabindex:-1}),f.data(l,{dir:f.attr("dir"),autocomplete:f.attr("autocomplete"),spellcheck:f.attr("spellcheck"),style:f.attr("style")}),f.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(e?d.input:d.inputWithNoHint);try{!f.attr("dir")&&f.attr("dir","auto")}catch(k){}return f.parent().hasClass("twitter-typeahead")||f.wrap(g),f.parent().css(d.wrapper).prepend(e?j:null).append(h)}function i(a){return{backgroundAttachment:a.css("background-attachment"),backgroundClip:a.css("background-clip"),backgroundColor:a.css("background-color"),backgroundImage:a.css("background-image"),backgroundOrigin:a.css("background-origin"),backgroundPosition:a.css("background-position"),backgroundRepeat:a.css("background-repeat"),backgroundSize:a.css("background-size")}}function k(a){var c=a.find(".tt-input");b.each(c.data(l),function(a,d){b.isUndefined(a)?c.removeAttr(d):c.attr(d,a)}),c.detach().removeData(l).removeClass("tt-input").insertAfter(a),a.remove()}var l="ttAttrs";return b.mixin(f.prototype,{_onSuggestionClicked:function(a,b){var c;(c=this.dropdown.getDatumForSuggestion(b))&&this._select(c)},_onCursorMoved:function(){var a=this.dropdown.getDatumForCursor();this.input.setInputValue(a.value,!0),this.eventBus.trigger("cursorchanged",a.raw,a.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue(),this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint(),this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint(),this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0,this.dropdown.open()},_onBlurred:function(){this.isActivated=!1,this.dropdown.empty(),this.dropdown.close()},_onEnterKeyed:function(a,b){var c,d;c=this.dropdown.getDatumForCursor(),d=this.dropdown.getDatumForTopSuggestion(),c?(this._select(c),b.preventDefault()):this.autoselect&&d&&(this._select(d),b.preventDefault())},_onTabKeyed:function(a,b){var c;(c=this.dropdown.getDatumForCursor())?(this._select(c),b.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close(),this.input.resetInputValue()},_onUpKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):this.dropdown.moveCursorUp(),this.dropdown.open()},_onDownKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):this.dropdown.moveCursorDown(),this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(a,b){this.input.clearHintIfInvalid(),b.length>=this.minLength?this.dropdown.update(b):this.dropdown.empty(),this.dropdown.open(),this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint(),this.dropdown.open()},_setLanguageDirection:function(){var a;this.dir!==(a=this.input.getLanguageDirection())&&(this.dir=a,this.$node.css("direction",a),this.dropdown.setLanguageDirection(a))},_updateHint:function(){var a,c,d,e,f,g;a=this.dropdown.getDatumForTopSuggestion(),a&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(c=this.input.getInputValue(),d=h.normalizeQuery(c),e=b.escapeRegExChars(d),f=new RegExp("^(?:"+e+")(.+$)","i"),g=f.exec(a.value),g?this.input.setHint(c+g[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(a){var b,c,d,e;b=this.input.getHint(),c=this.input.getQuery(),d=a||this.input.isCursorAtEnd(),b&&c!==b&&d&&(e=this.dropdown.getDatumForTopSuggestion(),e&&this.input.setInputValue(e.value),this.eventBus.trigger("autocompleted",e.raw,e.datasetName))},_select:function(a){this.input.setQuery(a.value),this.input.setInputValue(a.value,!0),this._setLanguageDirection(),this.eventBus.trigger("selected",a.raw,a.datasetName),this.dropdown.close(),b.defer(b.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(a){a=b.toStr(a),this.isActivated?this.input.setInputValue(a):(this.input.setQuery(a),this.input.setInputValue(a,!0)),this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy(),this.dropdown.destroy(),k(this.$node),this.$node=null}}),f}();!function(){var c,d,f;c=a.fn.typeahead,d="ttTypeahead",f={initialize:function(c,f){function g(){var g,h,i=a(this);b.each(f,function(a){a.highlight=!!c.highlight}),h=new k({input:i,eventBus:g=new e({el:i}),withHint:b.isUndefined(c.hint)?!0:!!c.hint,minLength:c.minLength,autoselect:c.autoselect,datasets:f}),i.data(d,h)}return f=b.isArray(f)?f:[].slice.call(arguments,1),c=c||{},this.each(g)},open:function(){function b(){var b,c=a(this);(b=c.data(d))&&b.open()}return this.each(b)},close:function(){function b(){var b,c=a(this);(b=c.data(d))&&b.close()}return this.each(b)},val:function(b){function c(){var c,e=a(this);(c=e.data(d))&&c.setVal(b)}function e(a){var b,c;return(b=a.data(d))&&(c=b.getVal()),c}return arguments.length?this.each(c):e(this.first())},destroy:function(){function b(){var b,c=a(this);(b=c.data(d))&&(b.destroy(),c.removeData(d))}return this.each(b)}},a.fn.typeahead=function(b){var c;return f[b]&&"initialize"!==b?(c=this.filter(function(){return!!a(this).data(d)}),f[b].apply(c,[].slice.call(arguments,1))):f.initialize.apply(this,arguments)},a.fn.typeahead.noConflict=function(){return a.fn.typeahead=c,this}}()}(window.jQuery),a.$=$}.apply(a,arguments)})}(this),define("header/header-search",["jquery","underscore","backbone","common/config","common/utils/string","common/search/models/search-singleton","hbs!header-tmpl/header-search-typeahead","bloodhound","common/utils/vent","hammerjs","jquery.typeahead"],function(a,b,c,d,e,f,g,h,i){var j=window._WML.TYPEAHEAD_HOST||"http://search-cdn.walmart.com/typeahead/v2/142487e83d0c/",k="typeaheadResult",l=200,m=2e3,n=300,o=10,p=12,q=5,r="",s="/search",t="/cp",u="query=",v="cat_id=",w="typeahead=",x="0",y=350,z=c.View.extend({el:".js-header",events:{"submit .js-searchbar":"_onSubmitSearchbar","click .js-searchbar-clear":"_onClickClearInput","click .js-searchbar-select li":"_onSearchbarDeptClick","click .header-normal .js-header-search-toggle":"_onSearchToggleClick","touchstart .header-normal .js-header-search-toggle":"_onSearchToggleClick"},initialize:function(){var c=this,s=p,t="MOBILE"===d.device||"TABLET"===d.device,u=0;b.bindAll(this,"_onSelectedTypeahead","_onKeyupTypeahead","_goToSearchOrCategoryPage","_isSearchPage","_filterResponse","_replaceUrl","_getCategoryId","_buildSearchParam","_onSearchToggleClick"),this.$headerWrapper=this.$el.parent(),this.$searchbarWrapper=this.$(".js-header-searchbar-wrapper"),this.$headerFlyout=this.$(".js-header-flyout"),this.$searchbar=this.$(".js-searchbar"),this.$typeaheadInput=this.$(".js-searchbar-typeahead-input"),this.$inputSearch=this.$searchbar.find(".js-searchbar-input"),this.$dropdownSearch=this.$searchbar.find(".js-flyout-toggle"),this.searchPageBridge=this._getWindow()._WML.ATLAS_SEARCH_BRIDGE,this._isSearchPage()&&(this.searchModel=f.getInstance()),t&&(s=q);var v=new h({name:"walmart",datumTokenizer:h.tokenizers.obj.whitespace("value"),queryTokenizer:h.tokenizers.whitespace,limit:s,remote:{url:j,replace:this._replaceUrl,ajax:{dataType:"jsonp",cache:!0,timeout:m,jsonpCallback:k},rateLimitWait:l,filter:this._filterResponse}});v.initialize(),this.$inputSearch.typeahead({hint:!1,highlight:!0},{templates:{suggestion:g},source:v.ttAdapter()}).on("keyup",b.debounce(this._onKeyupTypeahead,t?o:n)).on("typeahead:selected",this._onSelectedTypeahead),this.$searchbar.find(".twitter-typeahead").addClass("typeahead"),this.$searchbar.find(".tt-dropdown-menu").on("click",".tt-suggestion",function(a){a.preventDefault()}).on("touchstart",".tt-suggestion",function(){a(this).addClass("tt-cursor"),u=0}).on("touchmove",".tt-suggestion",function(){u++,a(this).removeClass("tt-cursor")}).on("touchend",".tt-suggestion",function(){var b=a(this),d=b.find("a").attr("href");if(a(this).removeClass("tt-cursor"),0===u){b.addClass("tt-suggestion-tapping");var f=e.getQueryParamByName("query",d);c.$inputSearch.typeahead("val",f),c.$inputSearch.trigger("typeahead:selected",{href:d,query:f,categoryID:e.getQueryParamByName("cat_id",d)||0})}}),this.$headerFlyout.on("shown",function(){c.$inputSearch.typeahead("close")}),t||this._getPathBase()===r&&b.defer(function(){c.$inputSearch.trigger("focus")}),this.listenTo(i,"search:query",this._onSearchQuery),a(this._getWindow()).off("scroll.globalsearch resize.globalsearch orientationchange.globalsearch"),t&&this._convertTypeaheadToMweb(),this._convertTypeaheadToSearch(t)},_isSmartPhone:function(){return"MOBILE"===d.device},_onSubmitSearchbar:function(a,c){var d,e={},f=this._getCategoryId();if(a.preventDefault(),this._isSmartPhone()&&(f=x,b.delay(b.bind(function(){this.$inputSearch.typeahead("close")},this),y)),this.searchPageBridge&&this.$inputSearch.trigger("blur"),c){if(d=c.href,e.source="typeahead",c.category&&c.categoryID)i.trigger("header:updateDropdown",c.category,c.categoryID);else if(f&&f!==x){var g=new RegExp(v);g.test(d)||(d+="&"+v+f)}c.categoryID&&(e.catId=c.categoryID);var h=this.$searchbar.find("pre").text();h&&(e.typeaheadText=h,e.query=this.$inputSearch.typeahead("val"),d+="&"+w+encodeURIComponent(h))}else e={query:this.$inputSearch.typeahead("val"),catId:f,source:"search-input"},d=this._buildSearchParam(e.query,e.catId);this._goToSearchOrCategoryPage(d,e)},_onSelectedTypeahead:function(a,b){b&&b.href&&this.$searchbar.trigger("submit",b)},_onKeyupTypeahead:function(){a.trim(this.$inputSearch.val()).length?this.$typeaheadInput.removeClass("empty"):this.$typeaheadInput.addClass("empty")},_onClickClearInput:function(a){a.preventDefault(),this.$inputSearch.typeahead("val","").trigger("focus").trigger("typeahead:closed"),this.$typeaheadInput.addClass("empty")},_onSearchbarDeptClick:function(){this.searchModel&&this.searchModel.setUserAction("searchbarDepartmentClick")},_goToSearchOrCategoryPage:function(a,b){var c=this.searchPageBridge;if(a)return c?void c.trigger("headerQueryUpdated",b):void(0===a.lastIndexOf(s)&&this.searchModel?(this.$inputSearch.typeahead("close").trigger("blur"),this.searchModel.fetchOrNavigate(a)):this._loadFullPage(a))},_buildSearchParam:function(b,c){var e="",f="",g=this.$searchbar.data("third-party");return g&&(f="//"+d.hostName),a.trim(b)?(e=f+s+"/?"+u+encodeURIComponent(b),c&&c!==x&&(e&&(e+="&"),e+=v+c)):c&&c!==x&&(e+=f+t+"/"+c),e},_filterResponse:function(b){var c=b.R,d=[],e=0,f=c.length;for(e=0;f>e;e++)if(0===e&&a.isArray(c[e])){var g=c[e],h=0,i=g.length;for(h=0;i>h;h++)if(0===h)d.push({value:g[0],href:this._buildSearchParam(g[0])});else if(1===h){var j=g[h],k=0,l=j.length;for(k=0;l>k;k++)d.push({value:g[0],href:this._buildSearchParam(g[0],j[k][1]),category:j[k][0],categoryID:j[k][1]})}}else d.push({value:c[e],href:this._buildSearchParam(c[e])});return d},_replaceUrl:function(a,b){return a+=this._isSmartPhone()?x:this._getCategoryId(),a+="/"+this._encodeQuery(b)+".js?"},_encodeQuery:function(b){return""===a.trim(b)?"":encodeURIComponent(b).replace(/\./g,"%2E").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/%/g,"_").toLowerCase()},_getCategoryId:function(){return this.$dropdownSearch.data("cat-id")||x},_getPathBase:function(){return window._WML.PATH_BASE},_isSearchPage:function(){return this._getPathBase()===s},_loadFullPage:function(a){window.location.href=a},_onSearchQuery:function(a){this.$inputSearch.typeahead("val",a)},_onSearchToggleClick:function(a){a&&a.preventDefault(),this.$searchbarWrapper.hasClass("searchbar-wrapper-expanded")?(this.searchPageBridge&&this.searchPageBridge.trigger("searchbarExpand",!1),this.$headerWrapper.removeClass("header-wrapper-search-exposed"),this.$searchbarWrapper.removeClass("searchbar-wrapper-front searchbar-wrapper-expanded")):(this.$searchbarWrapper.addClass("searchbar-wrapper-expanded searchbar-wrapper-front"),this.$inputSearch.trigger("focus"),this.searchPageBridge&&this.searchPageBridge.trigger("searchbarExpand",!0))},_convertTypeaheadToSearch:function(c){var d,e=this.searchPageBridge,f=this._getWindow(),g=this.$searchbar.find(".tt-dropdown-menu"),h=this.$searchbar.parents(".js-header"),i=this.$searchbarWrapper,j=this.$searchbar.find(".js-searchbar-overlay"),k=!1,l=!1;e&&(e.off("searchQueryChanged"),e.on("searchQueryChanged",b.bind(function(a){a=a||{},a.query&&this.$inputSearch.val(a.query)},this))),c&&(d=a(".js-header-searchbar-wrapper").height()-this.$searchbar.height(),h.addClass("search-mwebheader"),e&&(this.$inputSearch.off("focus.mweb keypress.mweb typeahead:opened.mweb"),this.$inputSearch.on("focus.mweb keypress.mweb typeahead:opened.mweb",function(){b.defer(function(){f.scrollTo(0,0),h.css("top",0),a(f).trigger("scroll.globalsearch")})})),a(f).on("typeahead:opened.mweb",function(){var b=j.offset();c?0!==b.left&&g.css({left:0-b.left,width:a(f).width()}):g.css({left:0,width:"100%"})}).on("touchend",function(a){("none"!==g.css("display")||k)&&a.preventDefault(),k&&(k=!1)}),a(f).hammer().on("tap",b.bind(function(){"none"!==g.css("display")&&(k=!0,this.$inputSearch.typeahead("close"))},this)),e&&(h.addClass("search-mwebheader-notsticky"),a(f).on("scroll.globalsearch resize.globalsearch orientationchange.globalsearch",function(){var a=f.pageYOffset||f.document.documentElement.scrollTop,b=h.height()-d,c=a>b,e="none"!==g.css("display");e?h.removeClass("search-mwebheader-floating").addClass("search-mwebheader-typeaheading").data("disable-persistentfocus",!0):(h.removeClass("search-mwebheader-typeaheading").removeData("disable-persistentfocus"),l!==c&&(c?i.hasClass("searchbar-wrapper-expanded")&&h.addClass("search-mwebheader-floating"):h.removeClass("search-mwebheader-floating"),l=c))})))},_convertTypeaheadToMweb:function(){this.$inputSearch.off("blur.tt")},_isGeorge:function(){return d.tenant===d.ENUMS.TENANTS.GEORGE_UK},_getWindow:function(){return window}});return z}),define("common/services/csl",["jquery","underscore","common/utils/object","bluebird","common/handy/lib/error-message-map"],function(a,b,c,d,e){function f(a){var c=b.map(a.allStores,function(c){var d=!!b.findWhere(a.preferredStores,{id:c.id}),e=b.contains(a.storeIdsNearDefaultLocation,c.id);return{id:c.id,storeType:b.extend({},c.storeType,{displayName:[c.address.city,c.storeType.displayName].join(" ")}),address:c.address,customerInfo:{distance:c.distance&&!d?c.distance:null,isPreferred:d,isWithinRange:e}}});return c}var g="/location",h=null,i=null,j=null;return{getCache:function(){return d.resolve(h)},getCacheSync:function(){return h},clearCache:function(){h=null,i=null,j=null},convert:function(a,c){if(b.isEmpty(a))return this.getCache();var d=b.isNumber(c)?b.first(f(a),c):f(a);return{defaultLocation:b.omit(a.defaultLocation,"name"),stores:d}},fetchUserPreferences:function(a){var b=this;return a=a||{},!a.forceUpdate&&h?this.getCache():this.ajax(this.getURL(a),"GET").then(function(d){return j=i,i=c.traverse("defaultLocation.postalCode",d)||null,h=b.convert(d,a.storeLimit),b.getCache()})},saveUserPreferences:function(a){a=a||{};var c=this;if(!b.isString(a.postalCode))throw new Error("Must pass in a string 'postalCode'.");var d={postalCode:a.postalCode};return this.ajax(this.getURL(a),"POST",{data:d}).then(function(d){if(b.isEmpty(d))throw new Error(e.unknown.message);return h=c.convert(d,a.storeLimit),j=i,i=a.postalCode,c.getCache()})},revertUserPreferences:function(a){a=a||{};var c=this;if(null===j)return this.clearCache(),d.resolve();var f={postalCode:j};return this.ajax(this.getURL({}),"POST",{data:f}).then(function(d){if(b.isEmpty(d))throw new Error(e.unknown.message);return h=c.convert(d,a.storeLimit),i=j,j=null,c.getCache()})},getURL:function(a){return a.includeStores&&a.includeStores.length?g+"?includeStores="+a.includeStores.join(","):g},ajax:function(b,c,e){var f=this;return new d(function(d,g){e=f.ajaxOptions(b,c,e),e.success=function(a){d(a)},e.error=function(a,b,c){g({jqXHR:a,textStatus:b,errorThrown:c})},a.ajax(e)},"csl#ajax "+c+" to "+b)},ajaxOptions:function(a,b,c){return c=c||{},c.url=a,c.type=b,c.dataType="json",c.context=this,c.processData=!1,c.data&&"GET"!==b&&(c.contentType="application/json",c.data=JSON.stringify(c.data)),c}}}),define("common/cart/collections/sub-collection",["underscore","jquery","thorax"],function(a,b,c){var d=c.Collection.extend({create:function(c,d){var e=this._prepareModel(c,d),f=this;return e.save(null,d).then(a.bind(function(a,d,e){return a=f.get(a.id),a=this._setSellerAttributes(a,c),b.Deferred().resolve(a,d,e)},this))},getEntityErrorCodes:function(){return this.reduce(function(a,b){var c=b.getEntityErrorCodes();return c.length&&(a[b.id]=c),a},{})},_setSellerAttributes:function(a,b){return a.set({moduleType:b.moduleType?b.moduleType:!1,sellerIdIndex:b.sellerIdIndex?b.sellerIdIndex:!1,sellerLinkDisplayOrder:b.sellerLinkDisplayOrder?b.sellerLinkDisplayOrder:!1}),a}});return d}),define("common/mixins/deep-model",["underscore","common/utils/object"],function(a,b){function c(a){if(!a.attributes)throw new Error("No `attributes` property found - is deepModel mixed in to a Backbone model?")}var d={getDeep:function(d){c(this);var e=b.traverse(d,this.attributes);return a.isUndefined(e)?null:e},setDeep:function(d,e,f){if(f=f||{},c(this),a.isUndefined(e))throw new Error("Must pass a value to `setDeep`.");if(this.getDeep(d)===e)return this;var g=b.createDeepProperty(d,this.attributes,e);return f.silent||a.isUndefined(g)||(this.trigger("change",this,f),this.trigger("change:deep",this,f)),this},ensurePathIsDefined:function(a){c(this),b.traverse(a,this.attributes,void 0,{createPath:!0})}};return d}),define("common/cart/error-codes",[],function(){var a=["400.CART_SERVICE.729","400.CART_SERVICE.723","400.CART_SERVICE.727","400.CART_SERVICE.733","400.CART_SERVICE.731","400.CART_SERVICE.808","400.CART_SERVICE.802","400.CART_SERVICE.806","400.CART_SERVICE.812","400.CART_SERVICE.810"],b=["400.CART_SERVICE.717","400.CART_SERVICE.710","400.CART_SERVICE.715","400.CART_SERVICE.721","400.CART_SERVICE.719"],c=["500.CART_SERVICE.489","500.CART_SERVICE.490","500.CART_SERVICE.492","500.CART_SERVICE.501","500.CART_SERVICE.502","500.CART_SERVICE.504","500.CART_SERVICE.ITEMSTORE.101","500.CART_SERVICE.ITEMSTORE.102","500.CART_SERVICE.ITEMSTORE.103","500.CART_SERVICE.SELLER.104","500.CART_SERVICE.PRICING.105","500.CART_SERVICE.SHIPMETHOD.106","500.CART_SERVICE.GRO.107"],d=["400.CART_SERVICE.1040","200.CART_SERVICE.1040","200.CART_SERVICE.1041","200.CART_SERVICE.1042","200.CART_SERVICE.1043","200.CART_SERVICE.1044"],e={CANNOT_ADD_TO_CART:"200.CART_SERVICE.714",SHIPPING_RESTRICTION_S2H:"200.CART_SERVICE.922",SHIPPING_RESTRICTION_S2S:"200.CART_SERVICE.924",MAX_QUANTITY_EXCEEDED:["400.CART_SERVICE.712","400.CART_SERVICE.725","400.CART_SERVICE.804"],LINE_ITEM_COUNT_MAX_LIMIT:"400.CART_SERVICE.1030",LIST_SERVICE_UNAVAILABLE:"500.LIST_SERVICE.500",STALE_DATA:c,INVALID_GROUP:d,BUNDLE_OUT_OF_STOCK:a,OFFER_OUT_OF_STOCK:b,OUT_OF_STOCK:a.concat(b)};return e}),define("common/cart/models/sub-model",["jquery","underscore","backbone","thorax","common/mixins/deep-model","common/cart/error-codes"],function(a,b,c,d,e,f){var g="62",h="GROUP",i="Inflexible Kit",j="Buy Together Value Bundle",k=3,l=5,m=d.Model.extend(b.extend({},e,{initialize:function(a,b){b=b||{},this.cart=b.cart||this.collection&&this.collection.cart,this.item=b.item,this._flagInvalidCarePlan()},uri:function(){var a=this.collection.uri();return this.isNew()?a:a.segment(this.get("id"))},url:function(){var a=this.uri();return"object"==typeof a?a.toString():void 0},parse:function(a){if(a.maxItemCountPerOrder||(a.maxItemCountPerOrder=null),a.assets||(a.assets={}),a.assets.primary||(a.assets.primary=[]),a.customAttributes){var c=b.chain(a.customAttributes).where({name:"PERSONALIZED_IMAGE_URL",type:"IMAGE_URL"}).map(function(a){return{raw:a.value}}).value();a.assets.primary.unshift.apply(a.assets.primary,c)}return a},sync:function(b,d,e){delete e.success;var f=function(b){return d.id||d.set({id:d._findCanonicalId(b)},{silent:!0}),d.cart.trigger("sync",d,b,e),d.cart.trigger("xhr:end"),a.Deferred().resolve(d,b,e)},g=function(a){return d.cart.trigger("xhr:end"),a};return d.cart.trigger("xhr:start",e),"patch"===b&&(b="update"),c.sync.call(this,b,d,e).then(f,g)},getEntityErrorCodes:function(){return b.pluck(this.get("entityErrors")||[],"code")},isWarranty:function(){return this.getDeep("marketingAttributes.item_class_id")===g},isBundle:function(){return this.get("type")===h},isInflexible:function(){return this.get("groupType")===i},isBtvBundle:function(){return this.get("groupType")===j},isBundleComponent:function(){return this.item&&this.item.isBundle()},quantity:function(){return this.get("quantity")||0},_flagInvalidCarePlan:function(){var a=!!this.item&&this.item.id,c=null;if(this.cart&&this.cart.get("entityErrors")){var d=b.find(this.cart.get("entityErrors"),function(d){var e=b.contains([f.INVALID_GROUP[k],f.INVALID_GROUP[l]],d.code);return!a||b.contains([f.INVALID_GROUP[l]],d.code)?(c=d.groupId,!0):b.contains(f.INVALID_GROUP,d.code)&&d.groupId===a&&e?!0:!1
});c&&this.cart.savedItems.get(c)?this.cart.savedItems.get(c).set("invalidCarePlan",d):this.item&&this.item.set("invalidCarePlan",d)}}}));return m}),define("common/cart/models/warranty",["underscore","backbone","thorax","common/cart/models/sub-model"],function(a,b,c,d){var e=d.extend({uri:function(){return this.item.uri().segment("warranty").segment(!this.isNew()&&this.id)},toJSON:function(){return a.pick(this.attributes,["offerId","quantity","groupId"])},isEdelivery:function(){return!0},isS2HFulfillable:function(){return!1},isWarranty:function(){return!0},isBundle:function(){return!1},isActive:function(){return this.item.warranty.get("offerId")===this.get("offerId")},_findCanonicalId:function(b){var c=this.item.get("offerId"),d=a.detect(b.items,function(a){return a.offerId===c}),e=d.warranty;return e.id}});return e}),define("common/cart/permitted-attributes",[],function(){return{ITEM:["configId","vendorId","customAttributes","offerId","quantity","groupId","groupComponents","careplanOfferId","careplanQuantity","registry","shipMethodDefaultRule","location","storeIds"],GROUP_COMPONENT:["offerId","quantity","shipMethodDefaultRule"],SAVED_ITEM:["configId","vendorId","customAttributes","offerId","quantity","price","storeId","groupId","groupComponents","careplanOfferId","careplanQuantity","shipMethodDefaultRule"],CART:["location","storeIds","currencyCode","customerId","customerId:CID","customerType","shipMethodDefaultRule"],CART_LOCATION:["postalCode","isDefault"]}}),define("common/cart/helpers/entity-errors",["jquery","underscore","common/utils/object","common/handy/lib/error-message-map"],function(a,b,c,d){function e(a,e){var f;return b.isString(e)&&(e=[e]),a&&b.isFunction(a.get)?f=a.get("entityErrors")||[]:(f=a&&a.responseJSON||a,f=c.traverse("cart.entityErrors",f)||[]),b.chain(f).pluck("code").intersection(e).map(function(a){return d[a]||d[g]}).value()}function f(c){return c=b.flatten(arguments),function(d){return b.isEmpty(e(d,c))?a.Deferred().resolve(d):a.Deferred().reject(d)}}var g="unknown";return{get:e,reject:f}}),define("common/cart/helpers/cart-shipping-dates",["moment","underscore"],function(a,b){var c=function(c,d){return d=b.extend({format:"MMM D"},d),b.map(c,function(b){var c,e,f,g,h,i=a(),j=b.minDate&&a(b.minDate),k=j&&j.diff(i,"days",!0),l=b.maxDate&&a(b.maxDate),m=b.preciseDate&&a(b.preciseDate),n=m&&m.diff(i,"days",!0),o=j&&l&&l.diff(j,"days",!0);if(j&&(c=j.format("MMM D")),j&&l&&(e=l.format(j.format("MM")!==l.format("MM")?"MMM D":"D")),f="Freight"===b.name?b.name:b.name+" shipping","Value"===b.name)o>=1?h=c+"-"+e:j&&(h=j.format(d.format));else if("Pickup Today"===b.name){if(j){var p=j.clone();p.get("minutes")>0&&p.add(1,"hours"),h=1>=k?" Today":" Tomorrow"}}else n&&1>=n?h="Today":n&&(h=m.format(d.format));return{name:f,isShippingPass:g,minDate:c,maxDate:e,displayDate:h,arrivesByHoliday:b.arrivesByHoliday}})};return c}),define("common/cart/helpers/cart-shipping-options",["moment","underscore","common/cart/helpers/cart-shipping-dates"],function(a,b,c){var d={Value:1,Standard:2,Expedited:3,Rush:4,Freight:5};return{getS2HOption:function(a){var c=(a||{}).S2H;return b.isArray(c)?b.first(c):null},getElectronicOption:function(a){var c=(a||{}).ELECTRONIC;return b.isArray(c)?b.first(c):null},sort:function(a){return b.sortBy(a,function(a){var b=a.name||a.method;return d[b]})},format:function(a,d){var e=a.get("shippingOptions")||{},f=this.getS2HOption(e)||{},g=f.methods||[],h=[];g.length&&(h=c(this.sort(g),d));var i=e.S2S||[],j=e.PUT||[],k=function(a){return a.methods&&a.methods[0]?(a=b.clone(a),a.methods=c(a.methods,d),b.extend(a,a.methods[0]),delete a.methods,a):null};i=b.compact(b.map(i,k)),j=b.compact(b.map(j,k));var l=b.pluck(j,"USStoreId");i=b.reject(i,function(a){return b.contains(l,a.destinationStoreId)});var m=j.concat(i);return{S2HAvailable:h.length>0,S2SAvailable:i.length>0,PUTAvailable:j.length>0,pickupAvailable:j.length||i.length,eDeliveryAvailable:!!this.getElectronicOption(e),S2HOptions:h.slice(0,6),S2SOptions:i,PUTOptions:j,pickupOptions:m.slice(0,6)}}}}),define("common/cart/models/item",["jquery","underscore","backbone","common/cart/models/sub-model","common/cart/models/warranty","common/cart/permitted-attributes","common/cart/helpers/entity-errors","common/cart/helpers/cart-shipping-options","common/cart/error-codes"],function(a,b,c,d,e,f,g,h,i){function j(a){a.warranty||(a.warranty=new e({},{item:a,cart:a.cart||a.collection&&a.collection.cart}))}var k=d.extend({initialize:function(){d.prototype.initialize.apply(this,arguments),j(this)},parse:function(a){if(a=d.prototype.parse.call(this,a),a.warranty){j(this),this.warranty.set(a.warranty);var c=b.findWhere(a.availableWarranties,{offerId:a.warranty.offerId});this.warranty.set("productId",c?c.productId:0),delete a.warranty}return a.shippingOptions&&a.shippingOptions.S2S&&(a.shippingOptions.S2S=b.filter(a.shippingOptions.S2S,function(a){return!!a.destinationStoreId})),a},toJSON:function(){var a=b.pick(this.attributes,f.ITEM);return a.groupComponents&&(a.groupComponents=b.map(a.groupComponents,function(a){return b.pick(a,f.GROUP_COMPONENT)})),a},isEdelivery:function(){return!!h.getElectronicOption(this.get("shippingOptions"))},isFulfillable:function(){return this.isEdelivery()||this.isS2HFulfillable()||this.isS2SFulfillable()||this.isPUTFulfillable()},isPUTFulfillable:function(){return b.chain(this.getDeep("shippingOptions.PUT")).pluck("methods").any(function(a){return!b.isEmpty(a)}).value()},isS2SFulfillable:function(){return b.chain(this.getDeep("shippingOptions.S2S")).pluck("methods").any(function(a){return!b.isEmpty(a)}).value()},isS2HFulfillable:function(){var a=h.getS2HOption(this.get("shippingOptions"));return a&&!b.isEmpty(a.methods)},addWarranty:function(a){return this.warranty.save(a)},updateWarranty:function(a){return this.warranty.save(a)},removeWarranty:function(){return this.warranty.destroy().then(function(a){a.clear()})},moveToSaved:function(b){var d=this,e=this.collection,f=this.uri().segment("transfer").toString();return b=b||{},e.cart.trigger("xhr:start"),c.ajax({url:f,type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({})}).then(g.reject(i.LIST_SERVICE_UNAVAILABLE)).then(function(c){return e.cart.trigger("sync",d,c,b),e.cart.trigger("xhr:end"),a.Deferred().resolve(d,c,b)},function(c){return e.cart.trigger("xhr:end"),a.Deferred().reject(d,c,b)})},getBundleItemIds:function(){return b.pluck(this.get("groupComponents"),"USItemId")},getBundleItems:function(){var a=this.cart,c=this;return b.map(this.get("groupComponents"),function(b){return new k(b,{cart:a,item:c})})},_findCanonicalId:function(a){var c=this.has("offerId")?"offerId":"groupId",d=this.get(c),e=b.detect(a.items,function(a){return a[c]===d});return e.id}});return k}),define("common/cart/collections/items",["common/cart/collections/sub-collection","common/cart/models/item"],function(a,b){var c=a.extend({uri:function(){return this.cart.uri().segment("items")},url:function(){return this.uri().toString()},model:b,initialize:function(a,b){this.cart=b.cart},getUnfulfillableItems:function(){return this.select(function(a){return!a.isFulfillable()})||[]}});return c}),define("common/cart/models/saved-item",["jquery","underscore","backbone","common/cart/models/sub-model","common/cart/permitted-attributes","common/cart/helpers/cart-shipping-options"],function(a,b,c,d,e,f){var g=d.extend({getBundleItems:function(){var a=this.cart,c=this;return b.map(this.get("groupComponents"),function(b){return new g(b,{cart:a,item:c})})},isFulfillable:function(){return this.get("availableQuantity")>0},isEdelivery:function(){return!!f.getElectronicOption(this.get("shippingOptions"))},isS2HFulfillable:function(){var a=f.getS2HOption(this.get("shippingOptions"));return a&&!b.isEmpty(a.methods)},moveToCart:function(b){var d=this,e=this.collection,f=this.uri().segment("transfer").toString();return b=b||{},e.cart.trigger("xhr:start"),c.ajax({url:f,type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({})}).then(function(c){return e.cart.trigger("sync",d,c,b),e.cart.trigger("xhr:end"),a.Deferred().resolve(d,c,b)},function(c){return e.cart.trigger("xhr:end"),a.Deferred().reject(d,c,b)})},toJSON:function(){return b.pick(this.attributes,e.SAVED_ITEM)},_findCanonicalId:function(a){var c=this.get("offerId"),d=b.detect(a.savedItems,function(a){return a.offerId===c});return d.id}});return g}),define("common/cart/collections/saved-items",["uri","common/config","common/cart/collections/sub-collection","common/cart/models/saved-item"],function(a,b,c,d){var e=c.extend({uri:function(){return a(b.apiHost).segment("saved").segment(this.cart.get("customerId")||":CID").segment("items")},url:function(){return this.uri().toString()},model:d,comparator:function(a){return-a.get("sort")},initialize:function(a,b){this.cart=b.cart}});return e}),define("common/helpers/cookies",[],function(){var a={getCookieDomain:function(){return(this._getWindow().location.hostname.match(/\.[^.]+\.[^.]+$/)||[])[0]},_getWindow:function(){return window}};return a}),define("common/hybrid/bridge",["underscore","uri","common/logger"],function(a,b,c){function d(a){return function(){if(f.isMobileApp())try{return a.apply(f,arguments)}catch(b){c.log.error(b,{errorMessage:"NativeBridge error",nativeBridge:e()})}}}function e(){return f._getWindow().NativeBridge}var f={isMobileApp:function(){return(this._getWindow()._WML||{}).isMobileApp},hasNativeBridge:function(){return!!e()},isHybrid:function(){return this.isMobileApp()&&this.hasNativeBridge()},presentModal:d(function(a){e().navigation.presentModal(a)}),dismissModal:d(function(){e().navigation.dismissModal()}),presentExternalURL:d(function(a){e().navigation.presentExternalURL(a)}),dialog:d(function(a,b){e().dialog(a,b)}),signIn:d(function(a,b,c){e().client.signIn(a,b,c)}),updateCartItemCount:d(function(a){e().cart.updateItemCount(a)}),showLoadingIndicator:d(function(){e().client.loadingIndicator.show()}),hideLoadingIndicator:d(function(){e().client.loadingIndicator.hide()}),toggleLoadingIndicator:function(a){a?this.showLoadingIndicator():this.hideLoadingIndicator()},setTitle:d(function(a){e().navigationBar.setTitle(a)}),setButtons:d(function(a,b){e().navigationBar.setButtons(a,b)}),navigateToItemPage:d(function(a){e().client.pushToItemPage(a)}),navigateToOrderDetails:d(function(a){e().client.pushToOrderDetails(a)}),navigateToHome:d(function(){e().client.navigateToHome()}),navigateToBrowser:d(function(a){var c=b(),d=b(a).hostname()?a:b.build({protocol:c.protocol(),hostname:c.hostname(),port:c.port(),path:a});e().client.navigateToBrowser(d)}),sendAnalyticsEvent:d(function(a){e().client.analytics.sendEvent(a)}),didFinishCheckout:d(function(){e().client.didFinishCheckout()}),animateForward:d(function(a){e().navigation.animateForward(a)}),animateBackward:d(function(){e().navigation.animateBackward()}),popToRoot:d(function(){e().navigation.popToRoot()}),setOnBack:d(function(a){e().navigation.setOnBack(a)}),showTabBar:d(function(){e().tabBar.show()}),hideTabBar:d(function(){e().tabBar.hide()}),showView:d(function(){e().view.show()}),setOnAppear:d(function(a){e().view.setOnAppear(a)}),setOnDisappear:d(function(a){e().view.setOnDisappear(a)}),info:d(function(){e().info()}),_getWindow:function(){return window}};return f}),define("common/cart/models/cart",["backbone","jquery","underscore","uri","thorax","bluebird","common/utils/object","common/config","common/services/csl","common/cart/collections/items","common/cart/collections/saved-items","common/mixins/deep-model","common/cart/permitted-attributes","common/shipping-pass-participation-level","common/logger","common/helpers/cookies","common/helpers/third-party","common/hybrid/bridge","jquery.cookie"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s="94066",t=5,u=6e4,v=e.Model.extend(c.extend({},l,{uriRoot:function(){return d(h.apiHost).segment("cart")},uri:function(){return this.uriRoot().segment(!this.isNew()&&":CRT")},urlRoot:function(){return this.uriRoot().toString()},url:function(){return this.uri().toString()},fetch:function(a){return e.Model.prototype.fetch.call(this,c.extend({url:this.uri().setQuery(this.getDefaultShippingProperties()).toString()},a))},itemsUri:function(a){return":CID"===a?this.uriRoot().segment("customer").segment(":CID").segment("items"):":ACID"===a?this.uriRoot().segment("guest").segment(":CID").segment("items"):this.uriRoot().segment(":CRT").segment("items")},defaults:function(){return{storeIds:[]}},useShipMethodDefaultRule:function(){return this._getWindow()._WML.USE_SHIP_METHOD_DEFAULT_RULE},getDefaultShippingRule:function(){var a=this.getShippingPassParticipationLevel();return a.subscribed?"SHIP_RULE_3":a.targeted?"SHIP_RULE_4":"SHIP_RULE_1"},getDefaultShippingProperties:function(){return this.useShipMethodDefaultRule()?{shipMethodDefaultRule:this.getDefaultShippingRule()}:{}},initialize:function(){this.items=new j([],{cart:this}),this.savedItems=new k([],{cart:this}),this._destroyedItemsByCid={},this._destroyedSavedItemsByCid={},this.on("sync",function(a,b,d){b.cart&&!b.cart.customAttributes&&this.set("customAttributes",{}),!b.cart||!c.isEmpty(this.get("customAttributes"))&&c.isEmpty(b.cart.customAttributes)||this.set("customAttributes",b.cart.customAttributes),b.items&&(this.items.set(b.items,{parse:!0}),this.trigger("items:set")),b.savedItems&&(this.savedItems.set(b.savedItems,{parse:!0}),this.trigger("savedItems:set")),b.cart&&(b.orchTimeout&&(b.cart.orchTimeout=b.orchTimeout),this.set(b.cart)),b.entityErrors&&this.set("entityErrors",(this.get("entityErrors")||[]).concat(b.entityErrors||[])),this.set("checkoutable",!!b.checkoutable),this.saveItemCount(),this.trigger("synced",a,b,d)},this),this.listenTo(this.items,"destroy",function(a){this.saveRestoreAttributes(a,this._destroyedItemsByCid,m.ITEM),this.listenToOnce(a,"sync",function(a,b){this.set(b),this.saveItemCount()})}),this.listenTo(this.savedItems,"destroy",function(a){this.saveRestoreAttributes(a,this._destroyedSavedItemsByCid,m.SAVED_ITEM)})},mergeWithCustomer:function(a){var b={url:this.uri().segment("merge").segment(a).query({resGroup:"detail"}).toString(),contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify(this.getDefaultShippingProperties())};return this.sync("create",this,b)},addItem:function(a,d){var e,f=this;return d=d||{},!a.careplanOfferId&&a.carePlan&&a.carePlan.offerId&&(a.careplanOfferId=a.carePlan.offerId,a.careplanQuantity=a.carePlan.quantity),(":CID"===d.userId||":ACID"===d.userId)&&(d.url=this.itemsUri(d.userId).toString()),c.extend(a,this.getDefaultShippingProperties()),e=(new b.Deferred).resolve(),e.then(function(){if(a&&(a.storeIds&&(a.storeIds=a.storeIds.slice(0,t),a.storeIds.length<=0&&delete a.storeIds),a.location&&a.location.postalCode)){var e=b.trim(a.location.postalCode);(e.length<=0||!e.match(/^\d+$/))&&(delete a.location,delete a.storeIds)}return f.items.create(a,c.extend(d,{cart:f}))})},updateItem:function(a,b){return c.extend(b,this.getDefaultShippingProperties()),this.items.get(a).save(b,{patch:!0})},removeItem:function(a){return this.items.get(a).destroy()},restoreItemByCid:function(a){var c=this._destroyedItemsByCid[a];return c?(delete this._destroyedItemsByCid[a],this.addItem(c)):b.Deferred().reject()},addSavedItem:function(a){var b=this.get("storeIds");return a.storeId||c.isEmpty(b)||(a.storeId=b[0]),this.savedItems.create(a,{cart:this})},restoreSavedItemByCid:function(a){var c=this._destroyedSavedItemsByCid[a];return c?(delete this._destroyedSavedItemsByCid[a],this.addSavedItem(c)):b.Deferred().reject()},saveRestoreAttributes:function(a,b,d){var e=c.pick(a.attributes,d);a.attributes.groupComponents&&(e.groupComponents=c.map(a.attributes.groupComponents,function(a){return c.pick(a,m.GROUP_COMPONENT)}));var f=a.warranty||a.attributes.warranty;f&&f.id&&(f=f.attributes||f,c.defaults(e,{careplanOfferId:f.offerId,careplanQuantity:f.quantity,groupId:f.groupId})),b[a.cid]=e},setAttributesFromCsl:function(a,b){b=c.extend({isDefault:!1},b);var d={},e=this.get("location")||{},f=this.get("storeIds")||[];if(a){var g=a.defaultLocation;g&&g.postalCode&&g.postalCode!==e.postalCode&&(d.location={postalCode:g.postalCode,isDefault:b.isDefault});var h=this.getCslStoreIds(a);c.isEqual(h,f)||(d.storeIds=h)}return this.set(d,b),this},updateLocation:function(a,d){var e=c.defaults(d||{},{silent:!0,skipCslUpdate:!1}),f=this,g=b.Deferred(),h={location:this.get("location"),storeIds:this.get("storeIds")};f.triggerXhrStart(e.silent);var j;return j=a&&!e.skipCslUpdate?i.saveUserPreferences(a).then(function(a){f.setAttributesFromCsl(a,{silent:!0})}):f.syncLocationFromCsl(),j.then(null,function(a){f.triggerXhrEnd(e.silent),g.reject(a)}).then(function(){var a=(h.location||{}).postalCode,b=(f.get("location")||{}).postalCode;a!==b?f.save().then(function(a,b,c){g.resolve(a,b,c),f.triggerXhrEnd(e.silent)},function(a,b,c){f.triggerXhrEnd(e.silent),i.saveUserPreferences(h.location),f.set(h,{silent:!0}),g.reject(a,b,c)}):(g.resolve(f),f.triggerXhrEnd(e.silent))}),g.promise()},triggerXhrStart:function(a){a||this.trigger("xhr:start")},triggerXhrEnd:function(a){a||this.trigger("xhr:end")},syncLocationFromCsl:function(){var a=this;return this.fetchLocationFromCsl().then(function(b,c){a.setAttributesFromCsl(b,c)})},fetchLocationFromCsl:function(){var a=this;return i.fetchUserPreferences().then(function(d){if(c.isEmpty(d)||c.isEmpty(d.defaultLocation)){var e;return c.isEmpty(d)||(e=a.getCslStorePostalCode(d)),e=e||s,i.saveUserPreferences({postalCode:e}).then(function(a){return b.Deferred().resolve(a,{isDefault:!0})})}return d})},getCslStoreIds:function(a){return c.chain(a.stores||[]).take(t).pluck("id").compact().uniq().value()},getCslStorePostalCode:function(a){return g.traverse("address.postalCode",c.first(a.stores))},updateCartCount:function(a){var d=this,e=this.readItemCount();return new f(function(f,g){if(c.isNumber(e))d.set("itemCount",e),f();else{var i=d.itemsUri(a).segment("count").toString(),j={hash:{thirdParty:h.isThirdparty,hostName:h.hostName}};b.ajax({type:"GET",url:q.completeUrl(i,j),contentType:"application/json; charset=UTF-8",dataType:"json",success:function(a){d.set("itemCount",a.itemCount),d.saveItemCount(),f()},error:function(a){404===a.status?(d.set("itemCount",0),d.saveItemCount(),f()):(o.log.error(a),g())}})}})},saveItemCount:function(){var a=this.get("itemCount");b.cookie("cart-item-count",a,{path:"/",domain:p.getCookieDomain()}),r.updateCartItemCount(a)},readItemCount:function(){var a=parseInt(b.cookie("cart-item-count"),10);return c.isNaN(a)?null:a},validateForCheckout:function(){var a=this,d=!1,e=parseInt(this.get("orchTimeout"),10),g=parseInt(this.get("lastCompleteItemsOrchTime"),10);if(c.isNumber(e)&&c.isFinite(e)||(e=null),c.isNumber(g)&&c.isFinite(g)||(g=null),e&&g){var h=new Date;d=h.getTime()-g>=e*u}return new f(function(e,g){d||!a.get("checkoutable")?f.resolve(b.ajax({type:"GET",url:a.uri().segment("checkoutability"),contentType:"application/json; charset=UTF-8",dataType:"json"})).then(function(b){a.set("checkoutable",b.checkoutable),!b.checkoutable||b.entityErrors&&!c.isEmpty(b.entityErrors)?g(b):e(b)}).caught(g):e()})},getUSItemIds:function(){return this.items.pluck("USItemId")},isFulfillable:function(){return this.items.all(function(a){return a.isFulfillable()})},getShippingPassParticipationLevel:function(){return n.getValue(b.cookie("SP")||"n")},parse:function(a){return a.cart.sflList=a.sflList,a=a.cart,a.fulfillmentTotals=a.fulfillmentTotals||{},a},toJSON:function(){var a=c.pick(this.attributes,m.CART);return a.location&&(a.location=c.pick(a.location,m.CART_LOCATION)),this.isNew()||(delete a.customerId,delete a["customerId:CID"],delete a.customerType),c.isArray(a.storeIds)&&c.isEmpty(a.storeIds)&&(this.isNew()?delete a.storeIds:a.storeIds=[]),a},sync:function(c,d,e){delete e.success;var f=function(a){return d.trigger("sync",d,a,e),d.trigger("xhr:end"),b.Deferred().resolve(d,a,e)},g=function(a){return d.trigger("xhr:end"),a};return d.trigger("xhr:start"),"patch"===c&&(c="update"),a.sync.call(this,c,d,e).then(f,g)},_getWindow:function(){return window},moveItemsToSaved:function(a){var c=this.itemsUri(this.get("customerId")).segment("transfer"),d=this;return new f(function(e,g){f.resolve(b.ajax({url:c,type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify({cartItemIdlist:a})})).then(function(a){d.trigger("sync",d,a),e()}).caught(g)})}}));return v}),define("common/cart/gateway",["jquery","underscore","common/config","common/utils/string","common/cart/models/cart","jquery.cookie"],function(a,b,c,d,e){var f=null,g=function(){this.model=new e},h="GUEST",i="CUSTOMER",j="com.wm.anoncart",k=".walmart.com",l="/";return b.extend(g.prototype,{reset:function(){f=null},hasLegacyCart:function(){return!!this.getLegacyCartId()},getLegacyCartId:function(){return a.cookie(j)},deleteLegacyCartId:function(){a.removeCookie(j,{domain:k,path:l})},hasACID:function(){return"1"===a.cookie("hasACID")},hasCID:function(){return"1"===a.cookie("hasCID")||!b.isEmpty(a.cookie("CID"))},hasCRT:function(){return"1"===a.cookie("hasCRT")},getCurrentCustomerType:function(){return this.hasCID()?i:h},hasPCID:function(){return"1"===a.cookie("hasPCID")},getCart:function(a){if(a=b.defaults(a||{},{reload:!1}),f&&!a.reload||a.reload&&f&&"pending"===f.state())return f;var c=this;return f=this.hasCRT()?this.fetch(this.model).then(function(a){return c.checkMergeCondition(a)}).then(function(a,b){return b?c.merge(a):a}):this.create(this.model)},addItem:function(b){var c=this,d=new a.Deferred;return this.checkMergeCondition(this.model).then(function(a,b){return b?c.fetch(a).then(function(a){return c.merge(a)}):a}).then(function(a){return c.hasCRT()&&(a.id=":CRT"),a}).then(function(a){var e=c.hasCRT(),f=c.hasCID();a.addItem(b,{userId:e?null:f?":CID":":ACID"}).then(function(a,b,c){d.resolve(a,b,c)},function(c){e&&404===c.status?a.addItem(b,{userId:f?":CID":":ACID"}).then(function(a,b,c){d.resolve(a,b,c)},function(a){d.reject(a)}):d.reject(c)})},function(a){d.reject(a)}),d.promise()},fetch:function(c){var d=this,e=new a.Deferred;return c.id=":CRT",c.fetch().then(function(a){e.resolve(a)},function(a){var f=a.responseJSON||{},g=404===a.status||"missing_cookie"===f.code||b.has(f,"validation")&&b.contains(f.validation.keys,"cartId");g?d.create(c).then(function(a){e.resolve(a)},function(a){e.reject(a)}):e.reject(a)}),e.promise()},create:function(b,c){var d=this,e=new a.Deferred;return b.id=null,b.set({customerType:this.getCurrentCustomerType(),"customerId:CID":""}),b.save().then(function(a){e.resolve(a)},function(a){var f=a.responseJSON||{},g="missing_cookie"===f.code&&(f.details.match(/\WCID\W/)||f.details.match(/\WhasCID\W/))&&!c;g?d.create(b,!0).then(function(a){e.resolve(a)},function(a){e.reject(a)}):e.reject(a)}),e.promise()},merge:function(b){var c=this,d=new a.Deferred;return this.checkMergeCondition(b).then(function(a,b){b?a.mergeWithCustomer(":CID").then(function(){d.resolve(a)},function(){c.fetch(a).then(function(a){d.resolve(a)},function(a){d.reject(a)})}):d.resolve(a)}),d.promise()},checkMergeCondition:function(b){var c=new a.Deferred;return this.hasCRT()&&this.hasCID()&&this.hasACID()&&!this.hasPCID()?c.resolve(b,!0):c.resolve(b,!1),c.promise()},_getWindow:function(){return window}}),new g}),define("header/header-cart-count",["jquery","underscore","backbone","common/cart/gateway","jquery.cookie"],function(a,b,c,d){var e="com.wm.cart.itemcount",f=c.View.extend({initialize:function(){this.setModel(d.model),this.initializeCount(),this.render()},initializeCount:function(){var b=!0;"1a"===a.cookie("WMP")&&(b=!1),this.onThankYouPage()&&(b=!1),this.onCartPage()&&(b=!1),b&&(d.hasCRT()?d.model.updateCartCount():d.hasCID()?d.model.updateCartCount(":CID"):d.hasACID()&&d.model.updateCartCount(":ACID"))},onCartPage:function(){return this.getWindow().location.pathname.match(/\/cart\/?/)},onThankYouPage:function(){return this.getWindow().location.pathname.match(/\/checkout\/thankyou\/?/)},getCount:function(){var c=this.model.get("itemCount"),d=parseInt(a.cookie(e),10)||0,f=b.isNumber(c)?c:d;return this.onThankYouPage()?0:f},setModel:function(a){this.stopListening(this.model),this.model=a,this.listenTo(this.model,"change",this.render)},render:function(){var a=this.getCount();1>a?this.$el.addClass("hide-content"):this.$el.removeClass("hide-content").addClass("header-cart-item-count"),this.$el.toggleClass("header-cart-item-count-99-plus",a>99),this.$el.text(a>99?"99+":a)},getWindow:function(){return window}});return f}),define("common/utils/geolocate",["modernizr"],function(a){var b={PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2,TIMEOUT:3,NOT_SUPPORTED:4},c={getCurrentLocation:function(d){if(!a.geolocation)return d({code:b.NOT_SUPPORTED});var e=c._getNavigator();e.geolocation.getCurrentPosition(c._handleSuccess(d),c._handleError(d))},_handleSuccess:function(a){return function(b){a(null,b)}},_handleError:function(a){return function(b){a(b)}},_getNavigator:function(){return navigator},ERR_CODES:b};return c}),define("header/header-mobile-storefinder",["jquery","underscore","backbone","common/utils/geolocate"],function(a,b,c,d){var e=c.View.extend({el:".js-header-mobile-storefinder",events:{click:"goToStorefinder"},goToStorefinder:function(c){c.preventDefault();var e=a(this.el).attr("href");d.getCurrentLocation(b.bind(function(b,c){if(!b){var d=this._formatPosition(c);d&&(e+="?"+a.param(d))}this._navigate(e)},this))},_formatPosition:function(a){try{var b=a.coords;return{latitude:b.latitude,longitude:b.longitude}}catch(c){return null}},_navigate:function(a){this._getWindow().location.href=a},_getWindow:function(){return window}});return e}),define("common/customer/customer",["jquery","underscore","common/helpers/cookies","jquery.cookie"],function(a,b,c){var d="customer",e=["firstName","lastName","emailAddress","isMigrated","cartItemCount","omsCustomerId","ReviewUser"],f=365;return{setAll:function(g,h){var i=a.Deferred();return g=b.pick(g,e),g.emailAddress&&!g.firstName&&(g.firstName=g.emailAddress.split("@")[0]),a.cookie(d,JSON.stringify(g),{path:"/",domain:c.getCookieDomain(),expires:f}),i.resolve(g),i.promise().then(h)},getAll:function(b){var c=a.Deferred(),e=a.cookie(d);return c.resolve(e?JSON.parse(e):{}),c.promise().then(b)},clear:function(b){var e=a.Deferred(),f=a.removeCookie(d,{path:"/",domain:c.getCookieDomain()});return a.removeCookie("cart-item-count",{path:"/",domain:c.getCookieDomain()}),e.resolve(f),e.promise().then(b)},set:function(a,b,c){var d=this;return this.getAll().then(function(c){c[a]=b,d.setAll(c)}).then(c)},get:function(a,b){return this.getAll().then(function(b){var c=b[a];return c}).then(b)}}}),define("header/nav-offcanvas",["jquery","underscore","common/utils/breakpoint-class-switcher","common/breakpoints","common/utils/string","common/customer/customer","common/config"],function(a,b,c,d,e,f,g){var h=27,i=100,j=172,k=function(){this.$body=a("body"),this.$header=this.$body.find(".js-header"),this.$navToggle=this.$header.find(".js-offcanvas-nav-toggle"),this.$overlay=this.$body.find(".js-header-overlay"),this.$offCanvasNav=this.$header.find(".js-nav-main"),this.$expand=this.$offCanvasNav.find(".js-nav-offcanvas-expand"),this.$loginText=this.$offCanvasNav.find(".js-nav-main-login-text"),this.offCanvasNavActive=!1,this.scroll=0,this.$rootMenu=this.$offCanvasNav.find(".js-nav-dropdown"),this.$currentMenu=null,this.$previousMenu=null};return k.prototype.init=function(){b.bindAll(this,"handleNavToggle","handleBack","handleOverlay","handleExpand","handleFlyouts","handleMenu"),this._addHandlers(),f.get("firstName",b.bind(function(a){this.customerName=e.toSentenceCase(a),this._setLoginStatus()},this))},k.prototype._addHandlers=function(){var c=this;g.atlasInlinedHeader||(this.$navToggle.on("click.offCanvasNav touchend.offCanvasNav",this.handleNavToggle),this.$rootMenu.on("click.offCanvasNav touch.offCanvasNav",".js-nav-menu-toggle",this.handleMenu),this.$expand.on("click.offCanvasNav touch.offCanvasNav",this.handleExpand),this.$offCanvasNav.find(".js-nav-main-back").on("click.offCanvasNav touch.offCanvasNav",this.handleBack),this.$overlay.on("click.offCanvasNav touchend.offCanvasNav",this.handleOverlay),this.$offCanvasNav.find(".js-global-eyebrow-nav .js-flyout-toggle").on("click.flyout touchstart.flyout mouseenter.flyout mouseleave.flyout",this.handleFlyouts),a(this._getWindow()).on("resize.offCanvasNav",b.debounce(function(){c.resizeOffCanvasNav()},i)).on("keyup.offCanvasNav",b.debounce(function(a){c.handleEscKey(a)},i)),this.$navToggle.removeClass("header-nav-toggle-hide")),this.$offCanvasNav.find(".js-nav-main-signout").on("click.offCanvasNav touch.offCanvasNav",f.clear)},k.prototype.handleNavToggle=function(a){a.preventDefault(),this._isMobileViewport()&&!this.offCanvasNavActive&&this.navOn()},k.prototype.navOn=function(){this.scroll=a(this._getWindow()).scrollTop(),this.$offCanvasNav.scrollTop(0),this.$overlay.css("top",this.scroll).removeClass("hide-content"),this.$body.addClass("nav-offcanvas-active"),this.$body.css("top",-1*this.scroll),this.offCanvasNavActive=!0},k.prototype.navOff=function(){this.$body.removeClass("nav-offcanvas-active"),this.$body.css("top",""),this.$overlay.css("top","").addClass("hide-content"),a(this._getWindow()).scrollTop(this.scroll),this.offCanvasNavActive=!1},k.prototype.handleBack=function(a){this.offCanvasNavActive&&(a.preventDefault(),a.stopPropagation(),this.$previousMenu&&(this.$previousMenu.removeClass("nav-menu-selected nav-submenu-selected"),this.$previousMenu=null),this.$currentMenu.removeClass("nav-menu-selected"),this.$currentMenu=null,this.$rootMenu.removeClass("nav-submenu-selected"),this.$offCanvasNav.removeClass("nav-offcanvas-depts"))},k.prototype.handleMenu=function(b){if(this.offCanvasNavActive){b.preventDefault(),b.stopPropagation();var c=a(b.target).closest(".js-nav-menu");if(c.is(this.$currentMenu))return!1;c.is(this.$previousMenu)?(this.$currentMenu.removeClass("nav-menu-selected"),this.$previousMenu.removeClass("nav-submenu-selected"),this.$currentMenu=this.$previousMenu,this.$previousMenu=null):(this.$currentMenu?this.$currentMenu.addClass("nav-submenu-selected"):(this.$rootMenu.addClass("nav-submenu-selected"),this.$offCanvasNav.addClass("nav-offcanvas-depts")),c.addClass("nav-menu-selected"),this.$offCanvasNav.scrollTop(0),this.$previousMenu=this.$currentMenu,this.$currentMenu=c)}},k.prototype.handleOverlay=function(a){a.preventDefault(),this.offCanvasNavActive&&this.navOff()},k.prototype.handleExpand=function(){this.$offCanvasNav.hasClass("nav-offcanvas-expanded")?this.$offCanvasNav.removeClass("nav-offcanvas-expanded"):(this.$offCanvasNav.addClass("nav-offcanvas-expanded"),this.$offCanvasNav.scrollTop(j))},k.prototype.handleFlyouts=function(a){this.offCanvasNavActive&&a.stopImmediatePropagation()},k.prototype._setLoginStatus=function(){b.isEmpty(this.customerName)||(this.$loginText.text(", "+this.customerName),this.$offCanvasNav.addClass("nav-offcanvas-signed-in"))},k.prototype.resizeOffCanvasNav=function(){this.offCanvasNavActive&&!this._isMobileViewport()&&this.navOff()},k.prototype.handleEscKey=function(a){a.keyCode===h&&this.navOff()},k.prototype._isMobileViewport=function(){return c.getCurrentBreakpoint()<d.l},k.prototype._getWindow=function(){return window},k}),define("common/utils/touch",["jquery","underscore","modernizr"],function(a,b,c){var d=400,e={previousTouchMoveEvent:{},previousTouchMoveDate:"",touchMoveEventName:"touchmove.ipadBody",$body:a("body"),xAxisSwipeThreshold:.5,isMouseMoveBlockApplied:!1,isTouch:function(){return c.touch&&!/phantom/i.test(navigator.userAgent)},applyMouseMoveBodyPrevent:function(){if(!this.isMouseMoveBlockApplied){var a=this;this.$body.on(this.touchMoveEventName,function(b){a.performMouseMoveSwipeCheck(b)}),this.isMouseMoveBlockApplied=!0}},removeMouseMoveBodyPrevent:function(){this.$body.off(this.touchMoveEventName)},performMouseMoveSwipeCheck:function(a){if(a&&a.originalEvent&&a.originalEvent.touches&&this.previousTouchMoveEvent&&this.previousTouchMoveDate){var b=(new Date).getTime(),c=this.previousTouchMoveEvent.pageX,d=a.originalEvent.pageX,e=(d-c)/(b-this.previousTouchMoveDate);
Math.abs(e>this.xAxisSwipeThreshold)&&a.preventDefault()}this.previousTouchMoveEvent=a.originalEvent,this.previousTouchMoveDate=(new Date).getTime()},ieTouchFix:function(a,c){var e,f,g,h=!1;if(window.PointerEvent)e="pointerup",f="touch";else{if(!window.MSPointerEvent)return;e="MSPointerUp",f=2}a.on(e,function(a){a.originalEvent.pointerType===f&&(h=!0,clearTimeout(g),g=b.delay(function(){h=!1},d),c&&c())}).on("mouseleave click",function(a){h&&(a.preventDefault(),a.stopImmediatePropagation())})}};return e}),define("header/persistent-nav-focus",["jquery","common/utils/touch"],function(a,b){var c={init:function(){var c=this;this.$input=a(".js-searchbar-input"),this.$inputOverlay=a(".js-searchbar-overlay"),this.$header=a(".js-header"),this.$whitelistedElements=this.$input.add("input[type=radio], input[type=checkbox], .typeahead-input"),this.$inputOverlay.add("body, input").off(".persistentNavFocus"),this.$inputOverlay.on("click.persistentNavFocus",function(){c._searchFocus()}),b.isTouch()&&(this.$inputOverlay.addClass("active"),a("input").not(this.$whitelistedElements).on("focus.persistentNavFocus",function(){var b=a(this);c._hidePersistentNav(),a(c._getDocument()).on("touchstart.persistentNavFocus",function(a){c._documentTouch(a,b)})}).on("blur.persistentNavFocus",function(){c._showPersistentNav()})),this.$headerWrapper=this.$header.parent(),this.$searchbarWrapper=a(".js-header-searchbar-wrapper"),this.searchPageBridge=window._WML.ATLAS_SEARCH_BRIDGE,a(".js-header-search-toggle").on("click touchstart",function(a){a.preventDefault(),c.$searchbarWrapper.hasClass("searchbar-wrapper-expanded")?(c.searchPageBridge&&c.searchPageBridge.trigger("searchbarExpand",!1),c.$headerWrapper.removeClass("header-wrapper-search-exposed"),c.$searchbarWrapper.removeClass("searchbar-wrapper-front searchbar-wrapper-expanded")):(c.$searchbarWrapper.addClass("searchbar-wrapper-expanded searchbar-wrapper-front"),c.$input.trigger("focus"),c.searchPageBridge&&c.searchPageBridge.trigger("searchbarExpand",!0))})},_searchFocus:function(){var b=this;this.$header.addClass("has-touchKeyboard").css("top",a(window).scrollTop()),a(window).on("scroll.persistentNavFocus",function(){b.$header.data("disable-persistentfocus")||b.$header.css("top",a(window).scrollTop())}),this.$input.trigger("focus.persistentNavFocus"),this.$inputOverlay.addClass("hide-content"),this.$input.one("blur.persistentNavFocus",function(){b.$inputOverlay.removeClass("hide-content")}),a(this._getDocument()).on("touchstart.persistentNavFocus",function(a){b._documentTouch(a)})},_documentTouch:function(b,c){c?c.is(b.target)||(a(b.target).is("a, button")||(b.preventDefault(),c.trigger("blur.persistentNavFocus")),a(this._getDocument()).off("touchstart.persistentNavFocus")):this.$input.is(b.target)||this.$inputOverlay.is(b.target)||(this.$input.trigger("blur.persistentNavFocus"),a(window).off("scroll.persistentNavFocus"),a(this._getDocument()).off("touchstart.persistentNavFocus"),this.$header.removeClass("has-touchKeyboard").css("top",""))},_hidePersistentNav:function(){this.$header.addClass("keyboard-hidden")},_showPersistentNav:function(){this.$header.removeClass("keyboard-hidden")},_getDocument:function(){return document}};return c}),function(a){define("jquery.smartbanner",["jquery"],function(){return function(){return!function(a){function b(){var a=document.createElement("smartbanner"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}var c=function(b){this.origHtmlMargin=parseFloat(a("html").css("margin-top")),this.options=a.extend({},a.smartbanner.defaults,b);var c=navigator.standalone,d=navigator.userAgent;if(this.options.force?this.type=this.options.force:null!=d.match(/Windows Phone 8/i)&&null!==d.match(/Touch/i)?this.type="windows":null!=d.match(/iPhone|iPod/i)||d.match(/iPad/)&&this.options.iOSUniversalApp?null!=d.match(/Safari/i)&&(null!=d.match(/CriOS/i)||window.Number(d.substr(d.indexOf("OS ")+3,3).replace("_","."))<6)&&(this.type="ios"):d.match(/\bSilk\/(.*\bMobile Safari\b)?/)||d.match(/\bKF\w/)||d.match("Kindle Fire")?this.type="kindle":null!=d.match(/Android/i)&&(this.type="android"),this.type&&!c&&!this.getCookie("sb-closed")&&!this.getCookie("sb-installed")){this.scale="auto"==this.options.scale?a(window).width()/window.screen.width:this.options.scale,this.scale<1&&(this.scale=1);var e=a("android"==this.type?'meta[name="google-play-app"]':"ios"==this.type?'meta[name="apple-itunes-app"]':"kindle"==this.type?'meta[name="kindle-fire-app"]':'meta[name="msApplication-ID"]');if(0!=e.length){if("windows"==this.type)this.appId=a('meta[name="msApplication-PackageFamilyName"]').attr("content");else{var f=/app-id=([^\s,]+)/.exec(e.attr("content"));if(!f)return;this.appId=f[1]}this.title=this.options.title?this.options.title:e.data("title")||a("title").text().replace(/\s*[|\-·].*$/,""),this.author=this.options.author?this.options.author:e.data("author")||(a('meta[name="author"]').length?a('meta[name="author"]').attr("content"):window.location.hostname),this.iconUrl=e.data("icon-url"),this.price=e.data("price"),this.create(),this.show(),this.listen()}}};c.prototype={constructor:c,create:function(){var b,c=this.options.url?this.options.url:("windows"==this.type?"ms-windows-store:navigate?appid=":"android"==this.type?"market://details?id=":"kindle"==this.type?"amzn://apps/android?asin=":"https://itunes.apple.com/"+this.options.appStoreLanguage+"/app/id")+this.appId,d=this.price||this.options.price,e=d?d+" - "+("android"==this.type?this.options.inGooglePlay:"kindle"==this.type?this.options.inAmazonAppStore:"ios"==this.type?this.options.inAppStore:this.options.inWindowsStore):"",f=null===this.options.iconGloss?"ios"==this.type:this.options.iconGloss;"android"==this.type&&this.options.GooglePlayParams&&(c=c+"&referrer="+this.options.GooglePlayParams);var g='<div id="smartbanner" class="'+this.type+'"><div class="sb-container"><a href="#" class="sb-close">&times;</a><span class="sb-icon"></span><div class="sb-info"><strong>'+this.title+"</strong><span>"+this.author+"</span><span>"+e+'</span></div><a href="'+c+'" class="sb-button"><span>'+this.options.button+"</span></a></div></div>";this.options.layer?a(this.options.appendToSelector).append(g):a(this.options.appendToSelector).prepend(g),this.options.icon?b=this.options.icon:this.iconUrl?b=this.iconUrl:a('link[rel="apple-touch-icon-precomposed"]').length>0?(b=a('link[rel="apple-touch-icon-precomposed"]').attr("href"),null===this.options.iconGloss&&(f=!1)):a('link[rel="apple-touch-icon"]').length>0?b=a('link[rel="apple-touch-icon"]').attr("href"):a('meta[name="msApplication-TileImage"]').length>0?b=a('meta[name="msApplication-TileImage"]').attr("content"):a('meta[name="msapplication-TileImage"]').length>0&&(b=a('meta[name="msapplication-TileImage"]').attr("content")),b?(a("#smartbanner .sb-icon").css("background-image","url("+b+")"),f&&a("#smartbanner .sb-icon").addClass("gloss")):a("#smartbanner").addClass("no-icon"),this.bannerHeight=a("#smartbanner").outerHeight()+2,this.scale>1&&(a("#smartbanner").css("top",parseFloat(a("#smartbanner").css("top"))*this.scale).css("height",parseFloat(a("#smartbanner").css("height"))*this.scale).hide(),a("#smartbanner .sb-container").css("-webkit-transform","scale("+this.scale+")").css("-msie-transform","scale("+this.scale+")").css("-moz-transform","scale("+this.scale+")").css("width",a(window).width()/this.scale)),a("#smartbanner").css("position",this.options.layer?"absolute":"static")},listen:function(){a("#smartbanner .sb-close").on("click",a.proxy(this.close,this)),a("#smartbanner .sb-button").on("click",a.proxy(this.install,this))},show:function(b){var c=a("#smartbanner");if(c.stop(),this.options.layer)c.animate({top:0,display:"block"},this.options.speedIn).addClass("shown").show(),a(this.pushSelector).animate({paddingTop:this.origHtmlMargin+this.bannerHeight*this.scale},this.options.speedIn,"swing",b);else if(a.support.transition){c.animate({top:0},this.options.speedIn).addClass("shown");var d=function(){a("html").removeClass("sb-animation"),b&&b()};a(this.pushSelector).addClass("sb-animation").one(a.support.transition.end,d).emulateTransitionEnd(this.options.speedIn).css("margin-top",this.origHtmlMargin+this.bannerHeight*this.scale)}else c.slideDown(this.options.speedIn).addClass("shown")},hide:function(b){var c=a("#smartbanner");if(c.stop(),this.options.layer)c.animate({top:-1*this.bannerHeight*this.scale,display:"block"},this.options.speedIn).removeClass("shown"),a(this.pushSelector).animate({paddingTop:this.origHtmlMargin},this.options.speedIn,"swing",b);else if(a.support.transition){"android"!==this.type?c.css("top",-1*this.bannerHeight*this.scale).removeClass("shown"):c.css({display:"none"}).removeClass("shown");var d=function(){a("html").removeClass("sb-animation"),b&&b()};a(this.pushSelector).addClass("sb-animation").one(a.support.transition.end,d).emulateTransitionEnd(this.options.speedOut).css("margin-top",this.origHtmlMargin)}else c.slideUp(this.options.speedOut).removeClass("shown")},close:function(a){a.preventDefault(),this.hide(),this.setCookie("sb-closed","true",this.options.daysHidden)},install:function(){this.options.hideOnInstall&&this.hide(),this.setCookie("sb-installed","true",this.options.daysReminder)},setCookie:function(a,b,c){var d=new Date;d.setDate(d.getDate()+c),b=encodeURI(b)+(null==c?"":"; expires="+d.toUTCString()),document.cookie=a+"="+b+"; path=/;"},getCookie:function(a){var b,c,d,e=document.cookie.split(";");for(b=0;b<e.length;b++)if(c=e[b].substr(0,e[b].indexOf("=")),d=e[b].substr(e[b].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c==a)return decodeURI(d);return null},switchType:function(){var b=this;this.hide(function(){b.type="android"==b.type?"ios":"android";var c=a("android"==b.type?'meta[name="google-play-app"]':'meta[name="apple-itunes-app"]').attr("content");b.appId=/app-id=([^\s,]+)/.exec(c)[1],a("#smartbanner").detach(),b.create(),b.show()})}},a.smartbanner=function(b){var d=a(window),e=d.data("smartbanner"),f="object"==typeof b&&b;e||d.data("smartbanner",e=new c(f)),"string"==typeof b&&e[b]()},a.smartbanner.defaults={title:null,author:null,price:"FREE",appStoreLanguage:"us",inAppStore:"On the App Store",inGooglePlay:"In Google Play",inAmazonAppStore:"In the Amazon Appstore",inWindowsStore:"In the Windows Store",GooglePlayParams:null,icon:null,iconGloss:null,button:"VIEW",url:null,scale:"auto",speedIn:300,speedOut:400,daysHidden:15,daysReminder:90,force:null,hideOnInstall:!0,layer:!1,iOSUniversalApp:!0,appendToSelector:"body",pushSelector:"html"},a.smartbanner.Constructor=c,void 0===a.support.transition&&(a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one(a.support.transition.end,function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b()}))}(window.jQuery),a.$=$}.apply(a,arguments)})}(this),define("header/app-banner",["jquery","backbone","jquery.smartbanner"],function(a,b){var c=b.View.extend({initialize:function(){var b=this,c=this.$(".js-smart-banner-container"),d=this.$(".js-header").hasClass("isAndroid"),e="http://go.onelink.me/2149671578?pid=HouseAd&c=MobileSite_TopBanner",f=-87;if(this._getDocument().referrer.indexOf(this._getDocument().location.hostname)>=0)d?a("meta[name=google-play-app]").remove():a("meta[name=apple-itunes-app]").remove(),c.addClass("hide-content");else if(a.smartbanner({title:"Save money. Live better.",author:"Walmart.com",daysReminder:0,appendToSelector:".js-smart-banner-container",url:e}),a("#smartbanner").length>0){var g=a("#smartbanner");a(window).scrollTop(f),a("#smartbanner .sb-close").one("click.closeButton",function(){c.addClass("hide-content"),b.$el.removeClass("banner-app-exposed")}),c.hasClass("hide-content")||(b.$el.addClass("banner-app-exposed"),a(window).on("scroll.smartBanner",function(){a(this).scrollTop()>0?(g.addClass("hide-content"),b.$el.removeClass("banner-app-exposed")):c.hasClass("hide-content")||(g.removeClass("hide-content"),b.$el.addClass("banner-app-exposed"))}))}},_getDocument:function(){return document}});return c}),define("common/plugins/list-fade",["jquery","underscore"],function(a,b){var c=function(c){return this.each(function(){var d,e=a(this),f=e.find(".js-message-list"),g=f.find(".js-message"),h=e.find(".js-next-btn"),i=e.find(".js-prev-btn"),j={fadeDuration:1e3,intervalTime:9e3,autoRotate:!0},k=g.length,l=null,m=b.extend(j,b.isObject(c)?c:{}),n=2*m.fadeDuration,o=function(){"string"==typeof c&&(d=c),"off"===d?(l=null,a(h).off("click.listFade"),a(i).off("click.listFade")):g.length>1?(h.on("click.listFade",function(){s(),p(r("next"))}),i.on("click.listFade",function(){s(),p(r("prev"))}),g.hover(function(){s()},function(){m.autoRotate?q():s()}),m.autoRotate?q():s()):(h.css("display","none"),i.css("display","none"))},p=function(a){1!==k&&g.filter(".active").fadeOut(m.fadeDuration,function(){g.removeClass("active"),a.addClass("active").fadeIn(m.fadeDuration)})},q=function(){f.addClass("slide"),l=setInterval(function(){p(r("next")),n=0},m.intervalTime-n)},r=function(a){var b=g.filter(".active")[a](),c="prev"===a?"last":"first";return b.length?b:g[c]()},s=function(){f.removeClass("slide"),g.stop(!0,!0),null!==l&&(clearInterval(l),l=null)};o()})};return a.fn.listFade=c,a}),define("header/header-init-mobile",["jquery","header/header-search","header/header-cart-count","header/header-mobile-storefinder","header/nav-offcanvas","header/persistent-nav-focus","header/app-banner","common/plugins/list-fade"],function(a,b,c,d,e,f,g){var h={init:function(){var h=new e;h.init(),new g({el:a(".js-header-wrapper")}),new c({el:a(".js-header-cart-count")}),new b,new d,f.init(),a(".js-header-list-fade").listFade()}};return h}),define("common/athena/athena-analytics",["jquery","underscore"],function(a,b){var c={getAthenaBeaconForZone:function(a,b){var c=this._isNewAthenaBeacon(a),d=c?this._getAthenaDataNew(a,b.zn):this._getAthenaData(a,b.zn);d&&(b.at=c?this._buildAnalyticsStringNew(d):this._buildAnalyticsString(d))},_getAthenaData:function(a,c){return b.find(a,function(a){return a.id===c})},_getAthenaDataNew:function(a,c){return b.find(a.detail,function(a){return a.athznid===c&&this._isAthenaZoneValid(a)},this)},_isAthenaZoneValid:function(a){return a.athcdid&&!b.isEmpty(a.athcdid)},_isNewAthenaBeacon:function(a){return a.athpgid&&a.detail&&!b.isEmpty(a.detail)},_buildAnalyticsString:function(a){var c=b.reduce(a.result.detail,function(a,b){return a+"cs:"+b.csType+",md:"+b.modelType+",cn:"+b.contentId+"~"},"");return c.substr(0,c.length-1)},_buildAnalyticsStringNew:function(a){var c=b.reduce(a.athcdid,function(a,b){return a+"athHasAds:"+b.hasAdsContents+",athcntItems:"+b.contentItems+",athcpid:"+b.contentId+",athPos:"+b.pos+",athstid:"+b.athstid+",athsdid:"+b.athsdid+",athsnid:"+b.athsnid+"~"},"athmtid:"+a.athmtid+"#");return c.substr(0,c.length-1)}};return c}),define("common/shims/performance-entries",["underscore"],function(a){function b(b){return{getEntries:b.getEntries?a.bind(b.getEntries,b):c,getEntriesByName:b.getEntriesByName?a.bind(b.getEntriesByName,b):c,getEntriesByType:b.getEntriesByType?a.bind(b.getEntriesByType,b):c,hasEntry:function(b){return!a.isEmpty(this.getEntriesByName(b))}}}var c=function(){return[]};return{get:function(){var a=this._getPerf()||{};return b(a)},_getPerf:function(){return window.performance}}}),define("common/analytics",["jquery","underscore","common/utils/object","common/utils/string","common/athena/athena-analytics","common/shims/performance-entries"],function(a,b,c,d,e,f){var g=/Item/,h="Footer",i={defaults:{registerFirstPageCarouselOnly:!1},globalAnalytics:function(){var a=this._getWindow(),d=c.traverse("_WML.analyticsPCTX.logMonID",a),e=c.traverse("_WML.analyticsPCTX.consumerHost",a),f=c.traverse("_WML.analyticsPCTX.cstmrShippingEligible",a),g=c.traverse("_WML.analyticsPCTX.cstmrShippingSubscribed",a),h=a._WML.pageTitle,i=null,j=null,k=null;d=b.isEqual(d,"[empty]")?"empty":d,h=b.isUndefined(h)?"empty":h,j={lg:d,pt:h},i="[empty]"!==e?{se:e}:{se:"empty"},k={se:f,sh:g},_bcq.push(["_addData","PCTX",[["cm",j],["dd",i],["cu",k]]])},_getWindow:function(){return window},emailSignupAnalytics:function(b){var c=a(b),d=c.find(".js-global-email-signup-heading");_bcq.push(["_tagAction",h,"ON_EMAIL_SUBSCRIBE","com.eml.sbs.clc",[["em",1,{id:d.attr("data-id"),nm:d.attr("data-header")}]]])},socialAnalytics:function(a){var b=a||{};_bcq.push(["_addData",b.action,[["so",b.call,{nm:b.socialMedia,id:b.id,ty:b.type}]]],["_tagAction",b.action,"ON_SOCIALSHARE","shr.soc.slc.clc",[["so",[b.call]]]])},performanceMetricsAnalytics:function(c,d){if(!b.isString(c)||""===a.trim(c))throw new Error("{string} context is required.");if(!b.isNumber(d)||b.isNaN(d))throw new Error("{number} aboveTheFoldEnd is required.");_bcq.push(["_setOptions",{above_the_fold_end:d}]),_bcq.push(["_tagAction",c,"PERFORMANCE_METRICS","prf.pgl.vww.pgl"])},performanceMarkerAnalytics:function(a,b,c){var d=f.get(),e=c||b;if(d.hasEntry(b)){var g=d.getEntriesByName(b)[0]||{},h={};g.startTime&&(h[e]=g.startTime,_bcq.push(["_setOptions",h]),_bcq.push(["_tagAction",a,"PERFORMANCE_MARKER","prf.pgl.vww.pgl"]))}},gatherLinkDataForModule:function(c,d,e){var f=this,g=[],h=[],i=[];return b.each(c,function(b,c){var j=a(b),k=j.data("uid"),l=j.data("asset-id")||void 0,m=j.attr("title")||void 0,n=f._calculateFrame(d,j);g.push(k),h.push(["li",k,{lc:c+1,ai:l,nm:m,pi:n}]),e.registerFirstPageCarouselOnly?1===n&&(i=i.concat(k)):i=i.concat(k)}),{linkKeys:i,dl:g,linkBcqAddDataArray:h}},gatherModuleBcqData:function(a,b,c,d){var f=a.moduleId[b],g=a.moduleName?a.moduleName[b]:void 0;if(g){var h=15;g=g.substring(0,h)}var i={id:f,ty:a.moduleType[b],nm:g,vr:a.moduleVersion[b],zn:a.moduleZoneId[b],od:a.moduleDisplayOrder[b],st:a.modulePublishedDate?a.modulePublishedDate[b]:void 0,dl:c};return d&&d.athena&&e.getAthenaBeaconForZone(d.athena,i),["co",f,i]},gatherModuleAndLinkBcqAddData:function(c,d,e){var f=[],g=[],h=[],i=this;return e=b.extend({},this.defaults,e),b.each(c.moduleDisplayOrder,function(b,j){var k=c.moduleId[j],l=a("[data-module-id="+k+"]"),m=l.find("*[data-uid]"),n=[];if(m.length){var o=i.gatherLinkDataForModule.call(i,m,c.moduleType[j],e);h=h.concat(o.linkKeys),n=o.dl,g=g.concat(o.linkBcqAddDataArray)}var p=i.gatherModuleBcqData.call(i,c,j,n,d);f.push(p)}),{linkKeys:h,bcqAddDataArray:g.concat(f)}},addDataAndSendBeaconWithBcqData:function(a,b,c,d,e){_bcq.push(["_addData",a,d],["_tagAction",a,b,c,e])},_calculateFrame:function(a,b){var c=1;switch(a){case"MultiStoryPOVResponsive":b.closest("li[data-pov]")&&(c=parseInt(b.closest("li[data-pov]").data("pov"),10)+1)}return c},addAnalyticsGlobalHandler:function(b,c){var d=c||".body";b.self=this,a(d).on("click","a, button, area",b,this.sendAnalyticsOnClick)},removeAnalyticsGlobalHandler:function(b){a(b).off("click","a, button, area",this.sendAnalyticsOnClick)},sendAnalyticsOnClick:function(b){var c,d=a(b.currentTarget),e=d.data("uid"),f=d.closest("[data-module-id]").data("module-id"),g=d.attr("href"),h=!0,i="dummyLinkKey";return b.data&&b.data.pageContext&&(c=b.data.pageContext),!e&&h&&(e=i,_bcq.push(["_addData",c,[["li",e,{lc:0,pi:0}]]])),g&&e&&f&&(_bcq.push(["_tagOutboundAction",c,"ON_UNIV_LINK","nav.unv.slc.clc",[["co",f],["li",e]],g,d.get(0)]),b.data&&b.data.self&&b.data.self.removeAnalyticsGlobalHandler(b.delegateTarget)),b.data&&b.data.preventDefault?(b.preventDefault(),!1):void 0},moduleView:function(a,c){b.each(a.moduleType,function(b,d){if(c[b]){var e=a.moduleId[d];this._gatherModuleViewAttributes(a,e,d)}},this)},_gatherModuleViewAttributes:function(b,c,d){var e=a("[data-module-id="+c+"]"),f=e.data("module"),h=[],i=[],j={};e.length&&(j.id=c,j.ty=f,j.vr=b.moduleVersion[d],h.push(["co",c,j]),i.push(["co",c]),h.push(["sc",{nm:f}]),i.push(["sc"]),g.test(f)?this._moduleViewForProductCarousels(e,h,i):this._callModuleViewBeacon(e,h,i))},_moduleViewForProductCarousels:function(a,b,c){var d,e,f=a.find(".js-carousel-n-up:visible .slick-list"),g=this._getSlickCarouselFrameData(f);g&&(d=g.beaconGroup,e=g.$displayedItems);var h=this._getItemTileProductData(e,d,b,c);h&&(b=h.data,c=h.attributeGroups),this._callModuleViewBeacon(a,b,c)},_callModuleViewBeacon:function(a,b,c){var d=this._getModuleViewContext(a);_bcq.push(["_addData",d,b],["_tagAction",d,"MODULE_VIEW","mod.prs.vww.mod",c])},_getModuleViewContext:function(a){var b=a.data("module"),c=a.closest("[data-zone]").data("zone");return b+="_"+d.normalizeNumber(c)},_getSlickCarouselFrameData:function(a){var b,c=a.find(".slick-active:not(.first-tile)"),d=c.length,e=c.eq(0).data("slick-index"),f=c.eq(-1).data("slick-index"),g={};return e=(e&&parseInt(e,10))+1,f=(f&&parseInt(f,10))+1,f&&d?(b=Math.ceil(f/d),g={pn:b,fi:e,li:f,ni:c.length,tr:a.find(".slick-slide").length},{beaconGroup:g,$displayedItems:c}):void 0},_getItemTileProductData:function(b,c,d,e){if(b&&b.length){var f={},g=[],h=[],i=b.map(function(){var b=a(this),c=b.find(".js-tile"),e=c.data("pangaea-product-id"),i=b.data("product-id"),j=c.data("display-price"),k=c.data("seller-id")||0,l=c.data("seller-name"),m={},n={};m.id=e,i&&(m.us=i),n.id=k,f[k]||(f[k]=!0,g.push(k)),l&&(n.nm=l);var o=[e,k];return d.push(["pr",e,m],["se",k,n],[["pr","se"],o,{dp:j}]),h.push(o),e}).get();return i.length&&(c.or=c.dt=i,d.push(["pl",c]),e.push(["pl"],["pr",i],[["pr","se"],h],["se",g])),{data:d,attributeGroups:e}}}};return i}),define("header/analytics",["common/analytics","header/analytics-data"],function(a,b){var c="Header",d={moduleAnalytics:function(){a.addAnalyticsGlobalHandler({pageContext:c},".js-header");var d=a.gatherModuleAndLinkBcqAddData(b,null,null);_bcq.push(["_addData",c,d.bcqAddDataArray]),a.globalAnalytics()},LHNAnalytics:function(){var a=[],d=[];if("[empty]"!==b.headerLHNlistName)for(var e=0,f=b.headerLHNlistName.length;f>e;e++)d[e]=e+1,a.push(["li",d[e],{id:b.headerLHNlistNameId[e],nm:b.headerLHNlistName[e]}]);else d[0]=1,a.push(["li",d[0],{id:"empty",nm:"empty"}]);_bcq.push(["_addData",c,a],["_tagAction",c,"ON_DEPTNAV_FLYOUT","nav.dnv.fly.hvr",[["li",d]]])},SDNAnalytics:function(a){var d=[],e=a,f=b.headerLHNlistNameId.length,g=0;"CD"===e?(g=1,e=0):"OD"===e?(g=f,e=f-1):"LHN-1-CD"===b.headerLHNlistNameId[0]?(g=e+2,e+=1):(g=e+1,e=e),d.push(["co",g,{id:b.headerLHNlistNameId[e]}]),_bcq.push(["_addData",c,d],["_tagAction",c,"ON_SUBDEPTNAV_FLYOUT","nav.dnv.fly.hvr",[["li",g],["co",g]]])}};return d}),define("header/header",["jquery","header/header-init-mobile","header/analytics","common/utils/environment"],function(a,b,c,d){d.entryPoint(function(){a(function(){b.init(),c.moduleAnalytics()})})});
//# sourceMappingURL=http://dev.walmart.com:9873/js-dist-atlas/header/header.map